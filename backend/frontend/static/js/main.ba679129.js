"use strict";(self.webpackChunkstory_app_frontend=self.webpackChunkstory_app_frontend||[]).push([[792],{145:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DETECTIVE_MECHANISM_GROUPS=t.DETECTIVE_MECHANISM_PRESETS=void 0,t.DETECTIVE_MECHANISM_PRESETS=[{id:"clockwork-orchestrator",label:"\u949f\u8868\u9f7f\u8f6e\u8fde\u52a8\u673a\u5173",description:"\u901a\u8fc7\u949f\u8868\u9f7f\u8f6e\u3001\u53d1\u6761\u4e0e\u8054\u52a8\u6746\u4ef6\u6784\u5efa\u5ef6\u65f6\u6216\u540c\u6b65\u89e6\u53d1\u7684\u673a\u68b0\u673a\u5173\u3002",keywords:["\u9f7f\u8f6e","\u53d1\u6761","\u949f\u8868","\u8054\u52a8"],realismHint:"\u73b0\u5b9e\u53ef\u5229\u7528\u53d1\u6761\u9a71\u52a8\u9f7f\u8f6e\uff0c\u901a\u8fc7\u8fde\u6746/\u91cd\u9524\u89e6\u53d1\u6697\u95e8\u6216\u5f00\u5173\uff0c\u5e38\u89c1\u4e8e\u8001\u5f0f\u81ea\u9e23\u949f\u7ed3\u6784\u3002",validatorGroup:"clockwork"},{id:"optical-phantom",label:"\u5149\u5f71\u955c\u50cf\u9519\u89c9\u673a\u5173",description:"\u5229\u7528\u955c\u9762\u3001\u6298\u5c04\u3001\u6295\u5f71\u7b49\u5149\u5b66\u624b\u6bb5\u5236\u9020\u76ee\u51fb\u9519\u89c9\u6216\u4f2a\u9020\u4e0d\u5728\u573a\u8bc1\u660e\u3002",keywords:["\u955c\u9762","\u6298\u5c04","\u6295\u5f71","\u5149\u7ebf"],realismHint:"\u53ef\u901a\u8fc7\u534a\u900f\u955c+\u6295\u5f71\u4eea\u6216\u504f\u632f\u73bb\u7483\u5236\u9020\u865a\u50cf\uff0c\u9700\u8981\u7a33\u5b9a\u5149\u6e90\u4e0e\u56fa\u5b9a\u89c2\u5bdf\u89d2\u5ea6\u652f\u6491\u3002",validatorGroup:"optical-illusion"},{id:"pressure-siphon",label:"\u538b\u529b\u4e0e\u7ba1\u9053\u89e6\u53d1\u673a\u5173",description:"\u501f\u52a9\u84b8\u6c7d\u3001\u6c14\u538b\u6216\u6db2\u538b\u5dee\u5f02\uff0c\u901a\u8fc7\u9600\u95e8\u4e0e\u7ba1\u9053\u7cfb\u7edf\u89e6\u53d1\u8fdc\u7a0b\u884c\u52a8\u3002",keywords:["\u538b\u529b","\u84b8\u6c7d","\u7ba1\u9053","\u9600\u95e8"],realismHint:"\u84b8\u6c7d\u9505\u7089\u3001\u8679\u5438\u6216\u6c14\u538b\u7f50\u5747\u53ef\u5b9e\u73b0\u8fdc\u7a0b\u63a8\u529b\uff0c\u9700\u9884\u5148\u5145\u80fd\u5e76\u7528\u9600\u95e8\u63a7\u5236\u65f6\u673a\u3002",validatorGroup:"pressure-trigger"},{id:"electro-magnetic-web",label:"\u7535\u78c1\u611f\u5e94\u673a\u5173",description:"\u5229\u7528\u7ebf\u5708\u3001\u7535\u6d41\u4e0e\u78c1\u573a\u53d8\u5316\uff0c\u5b9e\u73b0\u9690\u853d\u7684\u5438\u9644\u3001\u8131\u6263\u6216\u89e6\u53d1\u52a8\u4f5c\u3002",keywords:["\u7535\u78c1","\u78c1\u573a","\u7ebf\u5708","\u7535\u6d41"],realismHint:"\u5b9a\u65f6\u901a\u65ad\u7535\u53ef\u4ee5\u8ba9\u7535\u78c1\u94c1\u5438\u9644\u6216\u91ca\u653e\u91d1\u5c5e\u4ef6\uff0c\u5e38\u7528\u4e8e\u95e8\u7981\u4e0e\u5de5\u4e1a\u673a\u68b0\u3002",validatorGroup:"electro-magnetic"},{id:"chemical-latency",label:"\u5316\u5b66\u7f13\u91ca\u673a\u5173",description:"\u901a\u8fc7\u836f\u5242\u3001\u7f13\u91ca\u6750\u6599\u6216\u6c27\u5316\u53cd\u5e94\u5236\u9020\u5ef6\u65f6\u89e6\u53d1\u6216\u4f2a\u88c5\u73b0\u8c61\u3002",keywords:["\u836f\u5242","\u7f13\u91ca","\u5316\u5b66","\u6eb6\u5242"],realismHint:"\u7f13\u91ca\u80f6\u56ca\u3001\u5b9a\u65f6\u8150\u8680\u4e1d\u7ebf\u7b49\u5747\u53ef\u5b9e\u73b0\u5ef6\u8fdf\u89e6\u53d1\uff0c\u9700\u8981\u63a7\u5236\u6e29\u5ea6\u4e0e\u836f\u5242\u6d53\u5ea6\u3002",validatorGroup:"chemical-delay"},{id:"acoustic-resonator",label:"\u58f0\u5b66\u5171\u632f\u8ff7\u5c40",description:"\u5229\u7528\u9690\u853d\u7684\u97f3\u53c9\u3001\u5171\u9e23\u8154\u4e0e\u7ba1\u9053\u5236\u9020\u5b9a\u5411\u58f0\u6ce2\u6216\u56de\u58f0\uff0c\u4f2a\u9020\u76ee\u51fb\u8bc1\u8bcd\u3002",keywords:["\u5171\u9e23","\u58f0\u6ce2","\u97f3\u53c9","\u56de\u58f0"],realismHint:"\u4e50\u5668\u97f3\u7bb1\u3001\u98ce\u9053\u6216\u97f3\u53c9\u53ef\u5728\u7279\u5b9a\u9891\u7387\u653e\u5927\u58f0\u97f3\uff0c\u9700\u51c6\u5907\u5171\u9e23\u8154\u4f53\u4e0e\u53cd\u5c04\u9762\u3002",validatorGroup:"acoustic-resonance"},{id:"thermal-switch",label:"\u6e29\u5dee\u89e6\u53d1\u673a\u5173",description:"\u901a\u8fc7\u91d1\u5c5e\u70ed\u80c0\u51b7\u7f29\u3001\u6613\u7194\u5408\u91d1\u6216\u8721\u5c01\uff0c\u5b9e\u73b0\u5ef6\u8fdf\u5f00\u9501\u6216\u65ad\u7ef3\u7b49\u52a8\u4f5c\u3002",keywords:["\u6e29\u5ea6","\u7194\u70b9","\u91d1\u5c5e","\u8721\u5c01"],realismHint:"\u4f4e\u7194\u70b9\u5408\u91d1\u3001\u8721\u5c01\u6216\u53cc\u91d1\u5c5e\u7247\u53ef\u5728\u8bbe\u5b9a\u6e29\u5ea6\u677e\u8131\u9501\u6263\uff0c\u5e38\u7528\u4e8e\u6d88\u9632\u6216\u6d4b\u6e29\u88c5\u7f6e\u3002",validatorGroup:"thermal-trigger"},{id:"psychological-misdirect",label:"\u5fc3\u7406\u6697\u793a\u64cd\u63a7",description:"\u501f\u52a9\u89d2\u8272\u5fc3\u7406\u5f31\u70b9\u3001\u6697\u793a\u6216\u50ac\u7720\u8bb0\u5f55\u5f15\u5bfc\u9519\u8bef\u5224\u65ad\uff0c\u5f62\u6210\u5047\u4e0d\u5728\u573a\u8bc1\u660e\u3002",keywords:["\u5fc3\u7406","\u6697\u793a","\u8bb0\u5fc6","\u4e60\u60ef"],realismHint:"\u9700\u8981\u5148\u53d6\u5f97\u53d7\u5bb3\u8005\u4fe1\u4efb\u6216\u628a\u63e1\u5176\u4e60\u60ef\uff0c\u5229\u7528\u6697\u793a\u3001\u9053\u5177\u6216\u5f55\u50cf\u8bef\u5bfc\u5224\u65ad\u3002",validatorGroup:"psychological"},{id:"botanical-clock",label:"\u690d\u7269\u751f\u957f\u8ba1\u65f6\u673a\u5173",description:"\u5229\u7528\u542b\u7f9e\u8349\u3001\u85e4\u8513\u6216\u82b1\u7c89\u7b49\u690d\u7269\u751f\u7269\u949f\u5236\u9020\u65f6\u95f4\u5dee\u4e0e\u8bc1\u636e\u8bef\u5bfc\u3002",keywords:["\u690d\u7269","\u85e4\u8513","\u82b1\u7c89","\u542b\u7f9e\u8349"],realismHint:"\u9700\u63d0\u524d\u57f9\u80b2\u5bf9\u5149/\u89e6\u654f\u611f\u7684\u690d\u7269\uff0c\u5e76\u914d\u5408\u673a\u68b0\u62c9\u7d22\u6216\u9690\u85cf\u88c5\u7f6e\u624d\u80fd\u51c6\u786e\u89e6\u53d1\u3002",validatorGroup:"botanical"},{id:"remote-lever-network",label:"\u8fdc\u7a0b\u6760\u6746\u8054\u52a8\u673a\u5173",description:"\u5229\u7528\u7ef3\u7d22\u3001\u6760\u6746\u3001\u914d\u91cd\u4e0e\u9690\u85cf\u901a\u9053\u5b9e\u73b0\u8fdc\u7a0b\u89e6\u53d1\u6216\u4f2a\u88c5\u5bc6\u5ba4\u3002",keywords:["\u6760\u6746","\u914d\u91cd","\u6ed1\u8f6e","\u7ef3\u7d22"],realismHint:"\u821e\u53f0\u673a\u68b0\u5e38\u89c1\u7684\u6ed1\u8f6e+\u914d\u91cd\u53ef\u8de8\u623f\u95f4\u4f20\u529b\uff0c\u9700\u9690\u85cf\u7ef3\u7d22\u4e0e\u8f6c\u5411\u6ed1\u8f6e\u3002",validatorGroup:"remote-mechanism"}],t.DETECTIVE_MECHANISM_GROUPS={"remote-mechanism":{triggers:["\u8fdc\u7a0b","\u5bc6\u5ba4","\u81ea\u52a8","\u9065\u63a7","\u6760\u6746","\u914d\u91cd","\u6ed1\u8f6e","\u7ef3\u7d22","\u6697\u9053","\u8054\u52a8"],requires:["\u6760\u6746","\u914d\u91cd","\u6ed1\u8f6e","\u7ef3\u7d22","\u673a\u5173","\u8054\u52a8"]},clockwork:{triggers:["\u949f","\u949f\u8868","\u9f7f\u8f6e","\u53d1\u6761","\u8054\u52a8","\u9f7f\u6761","\u62e8\u9488"],requires:["\u9f7f\u8f6e","\u53d1\u6761","\u8054\u52a8"]},"optical-illusion":{triggers:["\u955c","\u955c\u9762","\u6298\u5c04","\u6295\u5f71","\u5149\u7ebf","\u5e7b\u5f71","\u5f71\u50cf"],requires:["\u955c","\u5149","\u6298\u5c04"]},"pressure-trigger":{triggers:["\u538b\u529b","\u6c14\u538b","\u6c34\u538b","\u84b8\u6c7d","\u7ba1\u9053","\u9600\u95e8","\u8679\u5438"],requires:["\u538b\u529b","\u7ba1\u9053","\u9600","\u5dee\u538b"]},"electro-magnetic":{triggers:["\u7535\u78c1","\u78c1\u573a","\u7ebf\u5708","\u7535\u6d41","\u7535\u8def","\u901a\u7535"],requires:["\u7535\u78c1","\u7ebf\u5708","\u7535\u6d41"]},"chemical-delay":{triggers:["\u5316\u5b66","\u836f\u5242","\u7f13\u91ca","\u6c27\u5316","\u50ac\u5316","\u6750\u6599","\u53cd\u5e94"],requires:["\u5316\u5b66","\u836f\u5242","\u7f13\u91ca"]},"acoustic-resonance":{triggers:["\u58f0\u97f3","\u56de\u58f0","\u5171\u9e23","\u97f3\u53c9","\u5e7f\u64ad","\u97f3\u9053"],requires:["\u58f0\u97f3","\u5171\u9e23","\u97f3"]},"thermal-trigger":{triggers:["\u6e29\u5ea6","\u70ed","\u7194\u70b9","\u8721","\u51b0","\u51b7\u5374","\u52a0\u70ed"],requires:["\u6e29\u5ea6","\u70ed","\u7194","\u91d1\u5c5e"]},psychological:{triggers:["\u5fc3\u7406","\u6697\u793a","\u8bb0\u5fc6","\u50ac\u7720","\u60c5\u7eea","\u9519\u89c9"],requires:["\u5fc3\u7406","\u6697\u793a","\u8bb0\u5fc6"]},botanical:{triggers:["\u690d\u7269","\u85e4\u8513","\u82b1\u7c89","\u79cd\u5b50","\u751f\u957f","\u6811"],requires:["\u690d\u7269","\u751f\u957f","\u82b1\u7c89"]}}},259:(e,t,s)=>{var a=s(878),r=s(664),n=s(330),l=s(229);function i(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter(Boolean).join(" ")}var o=s(782);const d={primary:"bg-points-primary/15 text-points-primary border border-points-primary/30",accent:"bg-points-accent-soft/30 text-points-accent border border-points-accent/30",magenta:"bg-points-magenta/20 text-points-magenta border border-points-magenta/30",success:"bg-points-success/20 text-points-success border border-points-success/30",warning:"bg-points-warning/15 text-points-text border border-points-warning/35",neutral:"bg-white text-points-text border border-points-border/50"};function c(e){let{children:t,icon:s,variant:a="primary",className:r}=e;return(0,o.jsxs)("span",{className:i("inline-flex items-center gap-1.5 rounded-points-pill px-3 py-1 text-xs font-medium tracking-wide",d[a],r),children:[s&&(0,o.jsx)("span",{className:"text-base",children:s}),t]})}const u={hud:"bg-[rgb(var(--points-hud-bg))]",hero:"bg-points-hero",magenta:"bg-points-magenta-wave"},m={lg:"max-w-4xl",xl:"max-w-5xl","2xl":"max-w-6xl","3xl":"max-w-7xl",full:"max-w-none"};function x(e){let{children:t,topBar:s,header:a,footer:r,backgroundVariant:n="hud",maxWidth:l="xl",className:d,containerClassName:c}=e;return(0,o.jsxs)("div",{className:i("relative min-h-screen overflow-hidden pb-16 pt-10 transition-colors ease-out",u[n],d),children:[(0,o.jsx)("div",{className:"absolute inset-0 pointer-events-none opacity-40",children:(0,o.jsx)("div",{className:"mx-auto h-full w-full max-w-7xl bg-gradient-to-tr from-white/20 via-transparent to-points-accent-soft/40"})}),(0,o.jsxs)("div",{className:i("relative mx-auto w-full px-5 sm:px-8",m[l],c),children:[s&&(0,o.jsx)("div",{className:"mb-6 flex items-center justify-between gap-4 text-sm text-points-text-muted",children:s}),a&&(0,o.jsx)("div",{className:"mb-10 space-y-6",children:a}),(0,o.jsx)("div",{className:"space-y-8",children:t}),r&&(0,o.jsx)("div",{className:"mt-10 border-t border-points-border/50 pt-6 text-sm text-points-text-muted",children:r})]})]})}function p(e){let{title:t,description:s,badge:a,icon:r,actions:n,children:l,layout:d="card",className:u,contentClassName:m}=e;const x="card"===d?"div":"section";return(0,o.jsxs)(x,{className:i("card"===d?"rounded-points-lg border border-points-border/60 bg-white/90 p-6 shadow-sm backdrop-blur-sm":"space-y-4",u),children:[(t||s||r||a||n)&&(0,o.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,o.jsxs)("div",{className:"space-y-2",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2 text-points-text-muted",children:[r&&(0,o.jsx)("span",{className:"text-points-primary",children:r}),a&&"string"===typeof a?(0,o.jsx)(c,{variant:"neutral",children:a}):a]}),t&&(0,o.jsx)("h2",{className:"text-2xl font-semibold text-points-text-strong",children:t}),s&&(0,o.jsx)("p",{className:"text-sm text-points-text-muted",children:s})]}),n&&(0,o.jsx)("div",{className:"flex flex-wrap items-center gap-3",children:n})]}),l&&(0,o.jsx)("div",{className:i("space-y-5",m),children:l})]})}var h=s(45);function v(){return(0,o.jsx)(h.l$,{position:"top-center",toastOptions:{duration:3500,style:{background:"rgba(255, 255, 255, 0.92)",color:"rgb(var(--points-text))",borderRadius:"var(--radius-lg)",border:"1px solid rgba(var(--points-border), 0.6)",boxShadow:"var(--shadow-soft)",padding:"14px 18px",fontWeight:600,fontFamily:"Quicksand, Nunito, sans-serif"},success:{iconTheme:{primary:"rgb(var(--points-success))",secondary:"#ffffff"}},error:{iconTheme:{primary:"rgb(var(--points-danger))",secondary:"#ffffff"}}}})}var g=s(957);const f={STORY_SESSION:"storyapp_current_session",STORY_HISTORY:"storyapp_story_history",USER_PREFERENCES:"storyapp_user_preferences"},b={soundEnabled:!0,animationEnabled:!0,fontSize:"medium",theme:"default",speechSpeed:1,speechPitch:1,autoPlay:!1,mute:!1,showTranscript:!0};function y(e){try{const t=j(),s=(0,g.A)((0,g.A)({},t),e);localStorage.setItem(f.USER_PREFERENCES,JSON.stringify(s))}catch(t){console.error("\u4fdd\u5b58\u7528\u6237\u504f\u597d\u5931\u8d25:",t)}}function j(){try{const e=localStorage.getItem(f.USER_PREFERENCES);return e?(0,g.A)((0,g.A)({},b),JSON.parse(e)):(0,g.A)({},b)}catch(e){return console.error("\u83b7\u53d6\u7528\u6237\u504f\u597d\u5931\u8d25:",e),(0,g.A)({},b)}}const N=(0,a.createContext)(void 0),w=e=>{let{children:t}=e;const[s,r]=(0,a.useState)(()=>j()),n=(0,a.useCallback)(e=>{r(t=>{const s=(0,g.A)((0,g.A)({},t),e);return y(s),s})},[]),l=(0,a.useCallback)(()=>{y(b),r((0,g.A)({},b))},[]),i=(0,a.useMemo)(()=>({preferences:s,updatePreferences:n,resetPreferences:l}),[s,l,n]);return(0,o.jsx)(N.Provider,{value:i,children:t})};var S=s(759);const E={primary:"bg-points-primary text-white shadow-points-soft hover:shadow-xl hover:-translate-y-0.5",secondary:"bg-white/90 text-points-text border border-points-border shadow-points-soft hover:bg-points-secondary/30",accent:"bg-points-magenta text-white shadow-points-soft hover:shadow-xl hover:-translate-y-0.5",success:"bg-gradient-to-r from-points-success to-points-primary text-white shadow-points-soft hover:shadow-xl",warning:"bg-gradient-to-r from-points-warning to-points-secondary text-points-text shadow-points-soft hover:saturate-125",danger:"bg-gradient-to-r from-points-danger to-points-magenta text-white shadow-points-soft hover:shadow-xl",ghost:"bg-transparent border border-dashed border-points-border text-points-text hover:bg-white/60"},A={small:"px-5 py-2.5 text-sm",medium:"px-6 py-3 text-base",large:"px-7 py-3.5 text-lg"};function C(e){let{children:t,onClick:s,disabled:a=!1,loading:r=!1,variant:n="primary",size:l="medium",icon:d,className:c="",testId:u,tabIndex:m,type:x="button"}=e;return(0,o.jsxs)(S.P.button,{whileHover:{scale:a||r?1:1.02},whileTap:{scale:a||r?1:.98},animate:{opacity:a?.65:1},transition:{type:"spring",stiffness:320,damping:20},onClick:()=>{a||r||(!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"click";try{const t=j();if(!t.soundEnabled||t.mute)return;const s=new(window.AudioContext||window.webkitAudioContext),a=s.createOscillator(),r=s.createGain();switch(a.connect(r),r.connect(s.destination),e){case"click":a.frequency.setValueAtTime(800,s.currentTime),a.frequency.exponentialRampToValueAtTime(400,s.currentTime+.1);break;case"success":a.frequency.setValueAtTime(523,s.currentTime),a.frequency.setValueAtTime(659,s.currentTime+.1),a.frequency.setValueAtTime(784,s.currentTime+.2);break;case"error":a.frequency.setValueAtTime(300,s.currentTime),a.frequency.exponentialRampToValueAtTime(200,s.currentTime+.3)}r.gain.setValueAtTime(.1,s.currentTime),r.gain.exponentialRampToValueAtTime(.001,s.currentTime+.3),a.start(s.currentTime),a.stop(s.currentTime+.3)}catch(t){}}("click"),null===s||void 0===s||s())},disabled:a||r,"data-testid":u,tabIndex:m,type:x,className:i("relative inline-flex items-center justify-center rounded-points-pill font-semibold tracking-wide transition-all duration-200 points-focus disabled:cursor-not-allowed disabled:saturate-75 select-none gap-2",E[n],A[l],r?"pointer-events-none":"",c),children:[r&&(0,o.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,o.jsx)(S.P.div,{animate:{rotate:360},transition:{duration:.9,repeat:1/0,ease:"linear"},className:"w-5 h-5 border-2 border-white/80 border-t-transparent rounded-full"})}),(0,o.jsxs)("div",{className:i("flex items-center gap-2",r?"opacity-0":"opacity-100"),children:[d&&(0,o.jsx)("span",{className:"flex-shrink-0 text-lg",children:d}),(0,o.jsx)("span",{className:"whitespace-nowrap",children:t})]})]})}function T(e){let{message:t="\u6b63\u5728\u521b\u4f5c\u795e\u5947\u7684\u6545\u4e8b...",size:s="medium"}=e;const a={small:"w-8 h-8",medium:"w-12 h-12",large:"w-16 h-16"}[s],r={small:"text-sm",medium:"text-base",large:"text-lg"}[s];return(0,o.jsxs)("div",{className:"flex flex-col items-center justify-center p-8",children:[(0,o.jsx)(S.P.div,{animate:{rotate:360,scale:[1,1.1,1]},transition:{rotate:{duration:2,repeat:1/0,ease:"linear"},scale:{duration:1.5,repeat:1/0,ease:"easeInOut"}},className:"".concat(a," mb-6"),children:(0,o.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",className:"h-full w-full",children:[(0,o.jsx)(S.P.path,{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20",stroke:"url(#gradient1)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,o.jsx)(S.P.path,{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z",stroke:"url(#gradient2)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,o.jsx)(S.P.path,{d:"M8 7h8",stroke:"url(#gradient1)",strokeWidth:"1.5",strokeLinecap:"round",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}}),(0,o.jsx)(S.P.path,{d:"M8 11h5",stroke:"url(#gradient2)",strokeWidth:"1.5",strokeLinecap:"round",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:1.5,repeat:1/0,ease:"easeInOut",delay:.3}}),(0,o.jsxs)("defs",{children:[(0,o.jsxs)("linearGradient",{id:"gradient1",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[(0,o.jsx)("stop",{offset:"0%",stopColor:"rgba(var(--points-secondary), 1)"}),(0,o.jsx)("stop",{offset:"100%",stopColor:"rgba(var(--points-primary), 1)"})]}),(0,o.jsxs)("linearGradient",{id:"gradient2",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[(0,o.jsx)("stop",{offset:"0%",stopColor:"rgba(var(--points-primary), 1)"}),(0,o.jsx)("stop",{offset:"100%",stopColor:"rgba(var(--points-magenta), 1)"})]})]})]})}),(0,o.jsx)(S.P.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-center font-semibold text-points-text-muted ".concat(r),children:t}),(0,o.jsx)("div",{className:"mt-3 flex gap-1",children:[0,1,2].map(e=>(0,o.jsx)(S.P.div,{animate:{y:[0,-8,0],opacity:[.4,1,.4]},transition:{duration:1.2,repeat:1/0,delay:.2*e,ease:"easeInOut"},className:"h-2 w-2 rounded-full bg-gradient-to-r from-points-secondary to-points-primary"},e))})]})}const k="/api".replace(/\/$/,"");async function _(e,t){var s;const a=await fetch(k.endsWith("/api")&&e.startsWith("/api")?"".concat(k).concat(e.replace(/^\/api/,"")):"".concat(k).concat(e),(0,g.A)({headers:{"Content-Type":"application/json"},credentials:"include"},t));if(!a.ok){const e=await a.json().catch(()=>({})),t=new Error((null===e||void 0===e?void 0:e.message)||a.statusText);throw t.status=a.status,t.code=null===e||void 0===e?void 0:e.error,t}const r=await a.json().catch(()=>({}));return null!==(s=null===r||void 0===r?void 0:r.data)&&void 0!==s?s:r}function I(e,t){const[s,r]=(0,a.useState)(null!==t&&void 0!==t?t:null),[n,l]=(0,a.useState)(()=>Boolean(e)&&!t),[i,o]=(0,a.useState)(null),d=(0,a.useCallback)(async t=>{const s=null!==t&&void 0!==t?t:e;if(!s){const e="\u7f3a\u5c11\u6545\u4e8b ID";throw o(e),new Error(e)}l(!0);try{const e=await async function(e){return _("/api/story-workflows/".concat(e))}(s);return r(e),o(null),e}catch(a){const e=(null===a||void 0===a?void 0:a.message)||"\u52a0\u8f7d\u6545\u4e8b\u5931\u8d25";throw o(e),a}finally{l(!1)}},[e]);return(0,a.useEffect)(()=>{!s&&e&&d(e).catch(()=>{})},[s,e,d]),{workflow:s,setWorkflow:r,isLoading:n,error:i,refresh:d}}var R=s(401),O=s(891),P=s(100),M=s(144),D=s(842);const L=["\u96fe\u5c9a\u53e4\u5821\u7684\u7b2c\u516b\u58f0","\u5348\u591c\u5217\u8f66\u7684\u5931\u8e2a\u4e58\u5ba2","\u56fe\u4e66\u9986\u7684\u955c\u9762\u8ff7\u5bab","\u96e8\u591c\u5c0f\u9547\u7684\u9690\u85cf\u949f\u58f0","\u94a2\u7434\u6559\u5ba4\u91cc\u7684\u65e0\u58f0\u594f\u9e23"],H=["Step 1 \xb7 \u89c4\u5212\u84dd\u56fe","Step 2 \xb7 \u9010\u7ae0\u5199\u4f5c","Step 3 \xb7 \u903b\u8f91\u5ba1\u9605","Step 4 \xb7 \u516c\u5e73\u6027\u6821\u9a8c"],U=["\u6b63\u5728\u5524\u9192\u4fa6\u63a2\u673a\u5173\uff0c\u8bf7\u7a0d\u5019\u2026","\u5730\u4e0b\u6863\u6848\u5ba4\u6b63\u5728\u68c0\u7d22\u7ebf\u7d22\u2026","\u6821\u5bf9\u65f6\u5e8f\u7ebf\uff0c\u786e\u4fdd\u516c\u5e73\u63a8\u7406\u2026","\u6253\u78e8\u6545\u4e8b\u8282\u594f\uff0c\u8ba9\u5c0f\u8bfb\u8005\u6613\u4e8e\u7406\u89e3\u2026"];function z(){const e=(0,l.Zp)(),[t,s]=(0,a.useState)(""),[r,n]=(0,a.useState)(!1),[i,d]=(0,a.useState)(""),c=r||0===t.trim().length,u=(0,a.useMemo)(()=>H.join(" \u2192 "),[]);return(0,o.jsxs)(x,{backgroundVariant:"hero",maxWidth:"2xl",topBar:(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)(R.A,{className:"h-5 w-5 text-points-primary"}),(0,o.jsx)("span",{className:"font-semibold text-points-text",children:"\u4fa6\u63a2\u6545\u4e8b\u5de5\u4f5c\u5ba4 \xb7 \u9605\u8bfb\u7248"})]}),(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsxs)(C,{variant:"ghost",size:"small",onClick:()=>{e("/history")},children:[(0,o.jsx)(O.A,{className:"mr-1 h-4 w-4"}),"\u5386\u53f2\u6545\u4e8b"]}),(0,o.jsxs)(C,{variant:"ghost",size:"small",onClick:()=>{e("/builder")},"data-testid":"advanced-mode-button",children:[(0,o.jsx)(P.A,{className:"mr-1 h-4 w-4"}),"\u9ad8\u7ea7\u6a21\u5f0f"]})]})]}),children:[(0,o.jsxs)("header",{className:"my-6 text-center",children:[(0,o.jsx)("h1",{className:"bg-gradient-to-r from-points-primary via-points-secondary to-points-accent bg-clip-text text-4xl font-black text-transparent md:text-5xl","data-testid":"hero-title",children:"\u4e00\u952e\u751f\u6210\u4f60\u7684\u539f\u521b\u4fa6\u63a2\u8c1c\u6848"}),(0,o.jsx)("p",{className:"mt-3 text-points-text-muted md:text-lg","data-testid":"hero-subtitle",children:"\u8f93\u5165\u4e3b\u9898 \u2192 AI \u81ea\u52a8\u5b8c\u6210\u84dd\u56fe\u3001\u5199\u4f5c\u3001\u6821\u9a8c\uff0c\u8ba9\u5b69\u5b50\u9605\u8bfb\u4e00\u90e8\u63a8\u7406\u5b8c\u6574\u7684\u6545\u4e8b\u3002"})]}),(0,o.jsx)(p,{title:"\u6545\u4e8b\u4e3b\u9898",layout:"card",className:"mb-6",children:(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("input",{type:"text",value:t,onChange:e=>s(e.target.value),placeholder:"\u4f8b\u5982\uff1a\u6d77\u8fb9\u706f\u5854\u7684\u6d88\u5931\u949f\u58f0",maxLength:120,disabled:r,"data-testid":"topic-input",className:"w-full rounded-2xl border-2 border-points-border bg-white px-5 py-4 text-lg shadow-soft transition focus:border-points-primary focus:outline-none disabled:cursor-not-allowed disabled:bg-points-surface"}),(0,o.jsxs)("span",{className:"pointer-events-none absolute right-4 top-1/2 -translate-y-1/2 text-sm text-points-text-muted",children:[t.length,"/120"]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"mb-2 text-sm text-points-text-muted",children:"\u7075\u611f\u63d0\u793a\uff1a"}),(0,o.jsx)("div",{className:"flex flex-wrap gap-2",children:L.map(e=>(0,o.jsx)("button",{type:"button",disabled:r,onClick:()=>(e=>{r||s(e)})(e),className:"rounded-full border border-points-border bg-white px-4 py-2 text-sm transition hover:border-points-primary hover:shadow-soft disabled:opacity-60",children:e},e))})]})]})}),(0,o.jsx)(p,{layout:"card",className:"mb-6 text-center",children:(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsx)("p",{className:"text-points-text-muted",children:u}),(0,o.jsx)(C,{variant:"primary",size:"large",disabled:c,onClick:async()=>{if(t.trim()){n(!0),d(U[Math.floor(Math.random()*U.length)]);try{const s=await async function(e,t){return _("/api/story-workflows",{method:"POST",body:JSON.stringify({topic:e,locale:t})})}(t.trim()),a=function(e){if(e)return e.workflowId||(null===e||void 0===e?void 0:e._id)}(s);if(!a)throw new Error("\u672a\u80fd\u83b7\u53d6\u6545\u4e8b ID");h.Ay.success("\u751f\u6210\u4efb\u52a1\u5df2\u542f\u52a8\uff0c\u521b\u4f5c\u8fdb\u5ea6\u62bd\u5c49\u4f1a\u5b9e\u65f6\u66f4\u65b0"),e("/story/".concat(a),{state:{workflow:s,openTimeline:!0}})}catch(s){const e=(null===s||void 0===s?void 0:s.message)||"\u751f\u6210\u6545\u4e8b\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5";h.Ay.error(e)}finally{n(!1),d("")}}else h.Ay.error("\u8bf7\u8f93\u5165\u6545\u4e8b\u4e3b\u9898")},"data-testid":"start-story-button",className:"min-w-[260px] !py-5 text-xl font-semibold shadow-soft disabled:opacity-60",children:r?(0,o.jsxs)("span",{className:"flex items-center justify-center gap-3",children:[(0,o.jsx)(T,{size:"small"}),i||"\u6b63\u5728\u751f\u6210\u6545\u4e8b\u2026"]}):(0,o.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,o.jsx)(M.A,{className:"h-6 w-6"}),"\u5f00\u59cb\u751f\u6210\u6545\u4e8b"]})}),(0,o.jsx)("p",{className:"text-xs text-points-text-muted",children:r?"\u6545\u4e8b\u751f\u6210\u9700\u6570\u5341\u79d2\uff0c\u8bf7\u4fdd\u6301\u9875\u9762\u6253\u5f00\u3002":"\u751f\u6210\u5b8c\u6210\u540e\u4f1a\u81ea\u52a8\u8df3\u8f6c\u81f3\u6545\u4e8b\u9605\u8bfb\u9875\u3002"})]})}),(0,o.jsx)(p,{title:"AI \u5982\u4f55\u5199\u4f5c",layout:"card",children:(0,o.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,o.jsxs)("div",{className:"rounded-2xl bg-gradient-to-br from-points-bg to-white p-4 shadow-sm",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2 text-points-primary",children:[(0,o.jsx)(D.A,{className:"h-5 w-5"}),(0,o.jsx)("span",{className:"font-semibold",children:"\u84dd\u56fe + \u6821\u9a8c"})]}),(0,o.jsx)("p",{className:"mt-2 text-sm text-points-text-muted",children:"\u6a21\u578b\u5148\u751f\u6210\u6848\u4ef6\u84dd\u56fe\uff0c\u518d\u9010\u7ae0\u5199\u4f5c\uff0c\u5e76\u7ecf\u8fc7\u903b\u8f91\u5ba1\u9605\u4e0e\u516c\u5e73\u6027\u6821\u9a8c\uff0c\u786e\u4fdd\u7ebf\u7d22\u53ef\u56de\u6536\u3001\u65f6\u95f4\u8f74\u4e00\u81f4\u3002"})]}),(0,o.jsxs)("div",{className:"rounded-2xl bg-gradient-to-br from-points-bg to-white p-4 shadow-sm",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2 text-points-primary",children:[(0,o.jsx)(M.A,{className:"h-5 w-5"}),(0,o.jsx)("span",{className:"font-semibold",children:"\u513f\u7ae5\u5411\u8bed\u6c14"})]}),(0,o.jsx)("p",{className:"mt-2 text-sm text-points-text-muted",children:"\u6587\u672c\u9488\u5bf9\u4e2d\u9ad8\u5e74\u7ea7\u9605\u8bfb\u6c34\u5e73\u5904\u7406\uff0c\u63a7\u5236\u53e5\u957f\u4e0e\u8bcd\u9891\uff0c\u9002\u5408\u4eb2\u5b50\u5171\u8bfb\u6216\u5c0f\u8bfb\u8005\u81ea\u8bfb\u3002"})]})]})})]})}const F=e=>{var t;let{storyId:s,segments:r,totalDuration:n}=e;const[l,i]=(0,a.useState)(0),[d,c]=(0,a.useState)(!1),[u,m]=(0,a.useState)(0),[x,p]=(0,a.useState)(!1),h=(0,a.useRef)(null),v=(0,a.useRef)(0),g=r[l];(0,a.useEffect)(()=>{const e=h.current;if(!e)return;const t=()=>{const t=v.current+e.currentTime;m(t)},s=()=>{p(!1)},a=()=>{p(!0)};return e.addEventListener("timeupdate",t),e.addEventListener("canplay",s),e.addEventListener("waiting",a),()=>{e.removeEventListener("timeupdate",t),e.removeEventListener("canplay",s),e.removeEventListener("waiting",a)}},[l]);const f=(0,a.useCallback)(()=>{if(l<r.length-1){const e=l+1;v.current+=r[l].duration,i(e),setTimeout(()=>{h.current&&d&&h.current.play().catch(e=>{console.error("\u64ad\u653e\u4e0b\u4e00\u6bb5\u5931\u8d25:",e),c(!1)})},50)}else c(!1)},[l,r,d]),b=(0,a.useCallback)(e=>{let t=0;for(let s=0;s<r.length;s++){const a=r[s].duration;if(t+a>e){i(s),v.current=t;const a=e-t;setTimeout(()=>{h.current&&(h.current.currentTime=a,d&&h.current.play().catch(e=>{console.error("\u8df3\u8f6c\u540e\u64ad\u653e\u5931\u8d25:",e),c(!1)}))},100);break}t+=a}},[r,d]),y=e=>{const t=Math.floor(e/60),s=Math.floor(e%60);return"".concat(t,":").concat(s.toString().padStart(2,"0"))};return null!==g&&void 0!==g&&g.error?(0,o.jsx)("div",{className:"story-audio-player bg-red-50 rounded-2xl shadow-lg p-6",children:(0,o.jsxs)("div",{className:"text-center text-red-600",children:[(0,o.jsx)("p",{className:"text-lg font-semibold",children:"\u274c \u97f3\u9891\u52a0\u8f7d\u5931\u8d25"}),(0,o.jsx)("p",{className:"text-sm mt-2",children:g.error})]})}):(0,o.jsxs)("div",{className:"story-audio-player bg-white rounded-2xl shadow-lg p-6 max-w-2xl mx-auto",children:[(0,o.jsx)("audio",{ref:h,src:null!==(t=null===g||void 0===g?void 0:g.audioUrl)&&void 0!==t?t:"",onEnded:f,preload:"auto"}),(0,o.jsxs)("div",{className:"text-center mb-4",children:[(0,o.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:(null===g||void 0===g?void 0:g.chapterTitle)||"\u6b63\u5728\u64ad\u653e"}),(0,o.jsxs)("p",{className:"text-sm text-gray-500",children:["\u7b2c ",l+1," / ",r.length," \u6bb5",(null===g||void 0===g?void 0:g.cached)&&" \xb7 \u5df2\u7f13\u5b58"]})]}),(0,o.jsxs)("div",{className:"mb-6",children:[(0,o.jsx)("input",{type:"range",min:0,max:n,value:u,onChange:e=>b(Number(e.target.value)),className:"w-full h-2 bg-blue-200 rounded-lg appearance-none cursor-pointer accent-blue-600",style:{background:"linear-gradient(to right, #3b82f6 0%, #3b82f6 ".concat(u/n*100,"%, #bfdbfe ").concat(u/n*100,"%, #bfdbfe 100%)")}}),(0,o.jsxs)("div",{className:"flex justify-between text-xs text-gray-600 mt-2",children:[(0,o.jsx)("span",{children:y(u)}),(0,o.jsx)("span",{children:y(n)})]})]}),(0,o.jsxs)("div",{className:"flex items-center justify-center gap-6",children:[(0,o.jsx)("button",{onClick:()=>b(Math.max(0,u-15)),className:"p-3 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors",title:"\u540e\u9000 15 \u79d2",disabled:x,children:(0,o.jsx)("svg",{className:"w-6 h-6 text-gray-700",fill:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{d:"M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"})})}),(0,o.jsx)("button",{onClick:()=>{const e=h.current;e&&(null!==g&&void 0!==g&&g.audioUrl?d?(e.pause(),c(!1)):(e.play().catch(e=>{console.error("\u64ad\u653e\u5931\u8d25:",e),c(!1)}),c(!0)):console.warn("\u5f53\u524d\u5206\u6bb5\u6ca1\u6709\u53ef\u64ad\u653e\u7684\u97f3\u9891"))},disabled:x,className:"p-4 rounded-full shadow-lg transition-all ".concat(x?"bg-gray-300 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 hover:scale-105"),children:x?(0,o.jsxs)("svg",{className:"w-8 h-8 text-white animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,o.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,o.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):d?(0,o.jsx)("svg",{className:"w-8 h-8 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"})}):(0,o.jsx)("svg",{className:"w-8 h-8 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{d:"M8 5v14l11-7z"})})}),(0,o.jsx)("button",{onClick:()=>b(Math.min(n,u+15)),className:"p-3 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors",title:"\u524d\u8fdb 15 \u79d2",disabled:x,children:(0,o.jsx)("svg",{className:"w-6 h-6 text-gray-700",fill:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{d:"M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z"})})})]}),!1]})};const V=s(966).A.create({baseURL:"/api",timeout:18e4,headers:{"Content-Type":"application/json"}});async function B(){try{return(await V.get("/health/tts/iflytek")).data}catch(e){throw console.error("\u83b7\u53d6\u8baf\u98de\u5065\u5eb7\u72b6\u6001\u5931\u8d25:",e),e}}async function G(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var t,s;return null!==(t=null===(s=(await V.get("/tts/tasks",{params:e})).data)||void 0===s?void 0:s.data)&&void 0!==t?t:{tasks:[],summary:void 0}}catch(a){throw console.error("\u83b7\u53d6 TTS \u4efb\u52a1\u5217\u8868\u5931\u8d25:",a),a}}V.interceptors.request.use(e=>e,e=>(console.error("\u274c API\u8bf7\u6c42\u9519\u8bef:",e),Promise.reject(e))),V.interceptors.response.use(e=>e,e=>{var t,s,a;console.error("\u274c API\u54cd\u5e94\u9519\u8bef:",e);const r={message:"\u8bf7\u6c42\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",status:(null===(t=e.response)||void 0===t?void 0:t.status)||500,code:(null===(s=e.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.code)||"UNKNOWN_ERROR"};if(e.response){var n,l;const t=e.response.status,s=(null===(n=e.response.data)||void 0===n?void 0:n.error)||(null===(l=e.response.data)||void 0===l?void 0:l.message);r.message=400===t?s||"\u8bf7\u6c42\u53c2\u6570\u9519\u8bef":404===t?s||"\u8bf7\u6c42\u7684\u8d44\u6e90\u4e0d\u5b58\u5728":429===t?"\u8bf7\u6c42\u6b21\u6570\u8fc7\u591a\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5":t>=500?"\u670d\u52a1\u5668\u6682\u65f6\u4e0d\u53ef\u7528\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5":s||r.message}else"ECONNABORTED"===e.code?r.message="\u8bf7\u6c42\u8d85\u65f6\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5":"NETWORK_ERROR"===e.code&&(r.message="\u7f51\u7edc\u8fde\u63a5\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc");return Promise.reject(r)});const W=e=>JSON.stringify({text:e.text,voiceId:e.voiceId,speed:e.speed,pitch:e.pitch,format:e.format}),q=1.5,J=15e3,K=e=>new Promise(t=>setTimeout(t,e));function Y(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const[t,s]=(0,a.useState)("idle"),[r,n]=(0,a.useState)(),[l,i]=(0,a.useState)(),[o,d]=(0,a.useState)(),c=(0,a.useRef)(new Map),u=(0,a.useCallback)(e=>{const t=W(e),s=c.current.get(t);if(s&&s.expiresAt>Date.now())return s.response;s&&c.current.delete(t)},[]),m=(0,a.useCallback)(async t=>{const a=(0,g.A)({format:"mp3",speed:e.defaultSpeed,pitch:e.defaultPitch,voiceId:e.defaultVoiceId,sessionId:e.sessionId},t),l=W(a);d(l);const o=c.current.get(l);if(o&&o.expiresAt>Date.now())return i((0,g.A)((0,g.A)({},o.response),{},{cached:!0})),s("ready"),n(void 0),(0,g.A)((0,g.A)({},o.response),{},{cached:!0});try{var u;s("loading"),n(void 0);const e=await async function(e){try{return(await V.post("/tts",e)).data}catch(r){throw console.error("\u8bed\u97f3\u5408\u6210\u8bf7\u6c42\u5931\u8d25:",r),r}}(a);if(!e.success)throw new Error(e.error||"\u8bed\u97f3\u5408\u6210\u5931\u8d25");const t=null!==(u=e.expiresIn)&&void 0!==u?u:0,o={response:e,expiresAt:Date.now()+1e3*t};return c.current.set(l,o),i((0,g.A)({},e)),s("ready"),e}catch(m){s("error");const e=(null===m||void 0===m?void 0:m.message)||"\u8bed\u97f3\u5408\u6210\u5931\u8d25";throw n(e),m}},[e.defaultPitch,e.defaultSpeed,e.defaultVoiceId,e.sessionId]),x=(0,a.useCallback)(async()=>{try{const e=await async function(){try{return(await V.get("/tts/voices")).data}catch(r){throw console.error("\u83b7\u53d6\u8bed\u97f3\u5217\u8868\u5931\u8d25:",r),r}}();return e}catch(e){throw n("\u83b7\u53d6\u8bed\u97f3\u5217\u8868\u5931\u8d25"),e}},[]),p=(0,a.useCallback)(async(e,t)=>{let a=0,r=Math.max(null!==t&&void 0!==t?t:3e3,1e3);for(;a<200;){var l;let t,m;a>0&&await K(r);try{t=await fetch("/api/tts/synthesize-story/status/".concat(encodeURIComponent(e)))}catch(d){a+=1,r=Math.min(r*q,J);continue}if(404===t.status){a+=1,r=Math.min(r*q,J);continue}if(429===t.status){let e=1e3*(Number(t.headers.get("Retry-After"))||0);if(!e)try{const s=await t.json();"number"===typeof(null===s||void 0===s?void 0:s.retryAfter)&&(e=1e3*s.retryAfter)}catch(c){}e||(e=r*q),r=Math.min(Math.max(e,1e3),J),a+=1;continue}try{m=await t.json()}catch(u){a+=1,r=Math.min(r*q,J);continue}if(!t.ok){var i;const e="string"===typeof(null===(i=m)||void 0===i?void 0:i.error)?m.error:"\u6545\u4e8b\u5408\u6210\u5931\u8d25";throw new Error(e)}const x=m;if("ready"===x.status){var o;const e={success:!0,storyId:x.storyId,totalSegments:x.totalSegments,successCount:x.successCount,totalDuration:x.totalDuration,segments:null!==(o=x.segments)&&void 0!==o?o:[],error:x.error};return s("ready"),n(void 0),e}if("error"===x.status)throw new Error(x.error||"\u6717\u8bfb\u5408\u6210\u5931\u8d25");const p=null!==(l=x.nextPollInMs)&&void 0!==l?l:r;r=Math.min(Math.max(p,r*q),J),a+=1}throw new Error("\u6717\u8bfb\u4efb\u52a1\u5904\u7406\u4e2d\uff0c\u8bf7\u7a0d\u540e\u5728\u9875\u9762\u4e2d\u5237\u65b0\u72b6\u6001\u518d\u8bd5")},[n,s]),h=(0,a.useCallback)(async t=>{try{s("loading"),n(void 0);const r=await fetch("/api/tts/synthesize-story",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify((0,g.A)((0,g.A)({},t),{},{sessionId:t.sessionId||e.sessionId,voiceId:t.voiceId||e.defaultVoiceId,speed:t.speed||e.defaultSpeed}))}),l=await r.json();if(202===r.status||"pending"===l.status){var a;const e=l,s=e.storyId||t.storyId;if(!s)throw new Error("\u6717\u8bfb\u4efb\u52a1\u7f3a\u5c11\u6807\u8bc6\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5");const r=null!==(a=e.nextPollInMs)&&void 0!==a?a:3e3;return await p(s,r)}if(!r.ok){const e=(null===l||void 0===l?void 0:l.message)||(null===l||void 0===l?void 0:l.error)||"\u6545\u4e8b\u5408\u6210\u5931\u8d25",t=new Error(e);throw t.code=null===l||void 0===l?void 0:l.error,t}const i=l;if(!i.success){const e=i.error||"\u6545\u4e8b\u5408\u6210\u5931\u8d25",t=new Error(e);throw t.code=i.error,t}return s("ready"),i}catch(r){s("error");const e=(null===r||void 0===r?void 0:r.message)||"\u6545\u4e8b\u5408\u6210\u5931\u8d25";throw n(e),r}},[e.sessionId,e.defaultVoiceId,e.defaultSpeed,p]);return(0,a.useMemo)(()=>({status:t,audioMeta:l,error:r,synthesize:m,synthesizeStory:h,getCachedResult:u,listVoices:x,lastRequestKey:o}),[l,r,u,o,x,t,m,h])}function Z(e){return String(e||"").replace(/\u3010?\[CLUE:[^\]]+\]\u3011?.*$/gm,"").replace(/\u3010?\[CLUE:[^\]]+\]\u3011?/g,"").replace(/\[CLUE:[^\]]+\]/g,"").replace(/\n{3,}/g,"\n\n").trim()}function $(e,t){return null!==t&&void 0!==t&&t.title?String(t.title):"\u7ae0\u8282 ".concat(e+1)}var Q=s(79),X=s(142),ee=s(705),te=s(900),se=s(976),ae=s(337),re=s(731),ne=s(253),le=s(194);function ie(e){switch(e){case EventSource.CONNECTING:return"CONNECTING (0)";case EventSource.OPEN:return"OPEN (1)";case EventSource.CLOSED:return"CLOSED (2)";default:return"UNKNOWN (".concat(e,")")}}const oe=["stage1_planning","stage2_writing","stage3_review","stage4_revision","stage5_validation"];function de(e){const[t,s]=(0,a.useState)([]),[r,n]=(0,a.useState)(!1),[l,i]=(0,a.useState)(void 0),[o,d]=(0,a.useState)({}),c=(0,a.useRef)(null),[u,m]=(0,a.useState)(0),x=(0,a.useRef)(!1),p=(0,a.useRef)(!1),[v,f]=(0,a.useState)(null);!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{enabled:s=!1,prefix:r="SSE"}=t,n=(0,a.useRef)(0),l=(0,a.useRef)(0),i=(0,a.useRef)(Date.now());(0,a.useEffect)(()=>{if(!e||!s)return;const t=Date.now(),a=()=>{},o=e=>{n.current++;const t=Date.now();let s;i.current,i.current=t;try{s=JSON.parse(e.data)}catch(a){s=e.data}},d=s=>{l.current++;const a=Date.now()-t;console.error("\u274c [".concat(r,"] Error #").concat(l.current),{readyState:e.readyState,readyStateText:ie(e.readyState),uptime:"".concat(Math.floor(a/1e3),"s"),messageCount:n.current,timestamp:(new Date).toISOString(),event:s})};e.addEventListener("open",a),e.addEventListener("message",o),e.addEventListener("error",d);const c=setInterval(()=>{Date.now(),Date.now(),i.current},3e4);return()=>{e.removeEventListener("open",a),e.removeEventListener("message",o),e.removeEventListener("error",d),clearInterval(c)}},[e,s,r])}(v,{enabled:!1,prefix:"SSE-".concat((null===e||void 0===e?void 0:e.slice(0,8))||"unknown")});const b=(0,a.useCallback)(e=>{var t;if("stage"!==e.category||!e.stageId)return;const s=null!==(t=e.meta)&&void 0!==t?t:{},a=s.detailType,r=s.detail;a&&d(t=>{const s=e.stageId,n=t[s],l=n?(0,g.A)({},n):{workflowId:e.workflowId,stageId:s,label:s,status:"pending",commands:[],logs:[],artifacts:[],updatedAt:e.timestamp};let i=!1;switch(l.workflowId||(l.workflowId=e.workflowId),a){case"status":{var o;const t=null!==(o=null===r||void 0===r?void 0:r.status)&&void 0!==o?o:l.status;t!==l.status&&(l.status=t,"running"!==t||l.startedAt||(l.startedAt=e.timestamp),"completed"!==t&&"failed"!==t||l.finishedAt||(l.finishedAt=e.timestamp),i=!0);break}case"start":case"complete":case"error":{const e=null===r||void 0===r?void 0:r.command;if(null===e||void 0===e||!e.id)break;const t=l.commands.slice(),s=t.findIndex(t=>t.id===e.id);if(s>=0){const a=t[s],r=(0,g.A)((0,g.A)({},a),e);t[s]=r}else t.push(e);l.commands=t,"start"===a?l.currentCommandId=e.id:l.currentCommandId===e.id&&(l.currentCommandId=void 0),i=!0;break}case"log":{const e=null===r||void 0===r?void 0:r.log;if(null===e||void 0===e||!e.id)break;l.logs.some(t=>t.id===e.id)||(l.logs=[...l.logs,e].sort((e,t)=>e.timestamp.localeCompare(t.timestamp)),i=!0);break}case"artifact":{const e=null===r||void 0===r?void 0:r.artifact;if(null===e||void 0===e||!e.id)break;l.artifacts.some(t=>t.id===e.id)||(l.artifacts=[...l.artifacts,e],i=!0);break}}return i?(l.updatedAt=e.timestamp,(0,g.A)((0,g.A)({},t),{},{[s]:l})):t})},[]),y=(0,a.useCallback)(e=>{if(!e||!Array.isArray(e.stages))return void d({});const t={};e.stages.forEach(e=>{var s,a,r;t[e.stageId]=(0,g.A)((0,g.A)({},e),{},{commands:null!==(s=e.commands)&&void 0!==s?s:[],logs:null!==(a=e.logs)&&void 0!==a?a:[],artifacts:null!==(r=e.artifacts)&&void 0!==r?r:[]})}),d(t)},[]),j=(0,a.useCallback)(()=>{i(void 0),n(!1),m(e=>e+1)},[]);(0,a.useEffect)(()=>{if(!e)return s([]),n(!1),i(void 0),x.current=!1,p.current=!1,void d({});let t=!1;const a=new AbortController;!async function(){try{const r=await fetch("/api/story-workflows/".concat(e,"/events"),{signal:a.signal});if(!r.ok)throw new Error("\u52a0\u8f7d\u5de5\u4f5c\u6d41\u4e8b\u4ef6\u5931\u8d25\uff1a".concat(r.statusText));const n=await r.json();if(!t){const e=Array.isArray(null===n||void 0===n?void 0:n.data)?n.data:[];s(e.sort((e,t)=>e.timestamp.localeCompare(t.timestamp)))}}catch(r){t||(i((null===r||void 0===r?void 0:r.message)||"\u83b7\u53d6\u5de5\u4f5c\u6d41\u4e8b\u4ef6\u5931\u8d25"),h.Ay.error((null===r||void 0===r?void 0:r.message)||"\u83b7\u53d6\u5de5\u4f5c\u6d41\u4e8b\u4ef6\u5931\u8d25"))}}(),async function(s){try{const a=await fetch("/api/story-workflows/".concat(e,"/stage-activity"),{signal:s});if(!a.ok)return;const r=await a.json();t||y(null===r||void 0===r?void 0:r.data)}catch(a){t||console.warn("\u83b7\u53d6\u9636\u6bb5\u6d3b\u52a8\u5931\u8d25",a)}}(a.signal);const r=new EventSource("/api/story-workflows/".concat(e,"/stream"));return f(r),r.onopen=()=>{n(!0),i(void 0),p.current&&(h.Ay.success("\u4e8b\u4ef6\u6d41\u5df2\u91cd\u65b0\u8fde\u63a5"),p.current=!1),x.current=!0},r.onmessage=e=>{try{const t=JSON.parse(e.data);s(e=>{return a=t,(s=e).some(e=>e.eventId===a.eventId)?s:[...s,a].sort((e,t)=>e.timestamp.localeCompare(t.timestamp));var s,a}),b(t)}catch(t){i((null===t||void 0===t?void 0:t.message)||"\u89e3\u6790\u5de5\u4f5c\u6d41\u4e8b\u4ef6\u5931\u8d25"),h.Ay.error((null===t||void 0===t?void 0:t.message)||"\u89e3\u6790\u5de5\u4f5c\u6d41\u4e8b\u4ef6\u5931\u8d25")}},r.onerror=()=>{n(!1),i("\u4e8b\u4ef6\u6d41\u8fde\u63a5\u65ad\u5f00\uff0c\u7a0d\u540e\u5c06\u81ea\u52a8\u91cd\u8fde"),x.current&&h.Ay.error("\u4e8b\u4ef6\u6d41\u8fde\u63a5\u65ad\u5f00\uff0c\u7a0d\u540e\u5c06\u81ea\u52a8\u91cd\u8fde"),p.current=!0,r.close(),f(null),c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{t||j()},2e3)},()=>{t=!0,a.abort(),r.close(),f(null),c.current&&(clearTimeout(c.current),c.current=null)}},[e,j,u,b,y]);const N=(0,a.useMemo)(()=>{const e={};for(const s of t)"stage"===s.category&&s.stageId&&(e[s.stageId]=s);return e},[t]),w=(0,a.useMemo)(()=>t.filter(e=>"tts"===e.category),[t]),S=(0,a.useMemo)(()=>t.filter(e=>"info"===e.category),[t]),E=(0,a.useMemo)(()=>{if(!t.length)return"idle";const e=oe.map(e=>{var t;return null===(t=N[e])||void 0===t?void 0:t.status});return e.every(e=>"completed"===e)?"completed":e.some(e=>"failed"===e)?"failed":e.some(e=>"running"===e)?"running":"pending"},[t.length,N]);return{events:t,stageStatus:N,ttsEvents:w,infoEvents:S,overallStatus:E,isConnected:r,error:l,refresh:j,stageActivity:o}}const ce={stage1_planning:"\u9636\u6bb5\u4e00 \xb7 \u84dd\u56fe\u89c4\u5212",stage2_writing:"\u9636\u6bb5\u4e8c \xb7 \u9010\u7ae0\u5199\u4f5c",stage3_review:"\u9636\u6bb5\u4e09 \xb7 \u5ba1\u9605\u8c03\u4f18",stage4_revision:"\u9636\u6bb5\u56db \xb7 \u4fee\u8ba2\u6574\u5408",stage5_validation:"\u9636\u6bb5\u4e94 \xb7 \u516c\u5e73\u6821\u9a8c"},ue={idle:"bg-slate-200 text-slate-600",pending:"bg-slate-200 text-slate-600",running:"bg-blue-100 text-blue-600",completed:"bg-emerald-100 text-emerald-600",failed:"bg-rose-100 text-rose-600"},me={pending:"bg-slate-100 text-slate-500",running:"bg-blue-100 text-blue-600",success:"bg-emerald-100 text-emerald-600",error:"bg-rose-100 text-rose-600"},xe={pending:"\u5f85\u5f00\u59cb",running:"\u6267\u884c\u4e2d",success:"\u5df2\u5b8c\u6210",error:"\u5931\u8d25"},pe="bg-emerald-100 text-emerald-600",he="bg-rose-100 text-rose-600",ve="bg-blue-100 text-blue-600",ge={idle:"\u5f85\u5f00\u59cb",pending:"\u5f85\u6267\u884c",running:"\u751f\u6210\u4e2d",completed:"\u5df2\u5b8c\u6210",failed:"\u5df2\u5931\u8d25"},fe=e=>{try{return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch(t){return e}},be=e=>{let{events:t,onEventAction:s}=e;const a=t.filter(e=>{var t;return!(null!==(t=e.meta)&&void 0!==t?t:{}).detailType});if(!a.length)return(0,o.jsx)("p",{className:"text-xs text-slate-500",children:"\u6682\u65e0\u4e8b\u4ef6"});return(0,o.jsx)("ul",{className:"space-y-2",children:(0,o.jsx)(le.N,{initial:!1,children:a.map(e=>{const t=Boolean(s)&&(e=>{var t;const s=null!==(t=e.meta)&&void 0!==t?t:{};return"number"===typeof s.chapterIndex||"number"===typeof s.scrollToChapter||"string"===typeof s.action})(e);return(0,o.jsxs)(S.P.li,{layout:"position",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.18},className:"rounded-lg border border-slate-100 bg-white/80 p-2 text-xs text-slate-600 shadow-sm transition ".concat(t?"cursor-pointer hover:bg-slate-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-points-primary/40":""),onClick:()=>t&&(null===s||void 0===s?void 0:s(e)),onKeyDown:a=>{t&&("Enter"!==a.key&&" "!==a.key||(a.preventDefault(),null===s||void 0===s||s(e)))},role:t?"button":void 0,tabIndex:t?0:-1,children:[(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsx)("span",{className:"font-medium text-slate-700",children:fe(e.timestamp)}),e.status&&(0,o.jsx)("span",{className:"rounded-full bg-slate-100 px-2 py-0.5 text-[10px] uppercase tracking-wide text-slate-500",children:e.status})]}),(0,o.jsx)("p",{className:"mt-1 leading-5 text-slate-600",children:e.message})]},e.eventId)})})})},ye=e=>{let{workflowId:t,storyTitle:s,initialOpen:r=!0,onScrollToChapter:n,onRequestExport:l,onRequestReadFull:i,onRetryFailedStage:d,onManualRefresh:c,onOpenChange:u,onTtsEventSuccess:m,isExporting:x=!1,isSynthesizing:p=!1,isRetryingStage:h=!1,hasFailedStage:v=!1,isTtsReady:g=!1}=e;const[f,b]=(0,a.useState)(r),[y,j]=(0,a.useState)(null),[N,w]=(0,a.useState)(null),[E,A]=(0,a.useState)(!1),{events:T,stageStatus:k,ttsEvents:_,infoEvents:I,overallStatus:R,isConnected:O,error:P,refresh:M,stageActivity:D}=de(t),L=(0,a.useMemo)(()=>{const e={};for(const t of T)"stage"===t.category&&t.stageId&&(e[t.stageId]||(e[t.stageId]=[]),e[t.stageId].push(t));return e},[T]),H=ue[R];(0,a.useEffect)(()=>{t?r&&b(!0):b(!1)},[t,r]),(0,a.useEffect)(()=>{null===u||void 0===u||u(f)},[f,u]);const U=(0,a.useRef)(null);(0,a.useEffect)(()=>{"completed"===R&&"completed"!==U.current&&(null===c||void 0===c||c()),U.current=R},[R,c]);const z=(0,a.useCallback)(async()=>{if(!t)return j(null),w(null),void A(!1);A(!0),w(null);try{const e=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return null;try{var s,a;return null!==(s=null===(a=(await V.get("/tts/tasks/".concat(encodeURIComponent(e),"/latest"),{params:t.provider?{provider:t.provider}:void 0})).data)||void 0===a?void 0:a.data)&&void 0!==s?s:null}catch(P){var r;if(404===((null===P||void 0===P?void 0:P.status)||(null===P||void 0===P||null===(r=P.response)||void 0===r?void 0:r.status)))return null;throw console.error("\u83b7\u53d6 TTS \u6700\u65b0\u4efb\u52a1\u5931\u8d25:",P),P}}(t);j(e)}catch(e){w((null===e||void 0===e?void 0:e.message)||"\u83b7\u53d6\u6700\u65b0\u6717\u8bfb\u4efb\u52a1\u5931\u8d25")}finally{A(!1)}},[t]);(0,a.useEffect)(()=>{z()},[z]),(0,a.useEffect)(()=>{if(!_.length)return;const e=_[_.length-1];"success"!==e.status&&"error"!==e.status||z(),"success"===e.status&&(null===m||void 0===m||m(e))},[_,z,m]);const F=(0,a.useCallback)(()=>{b(e=>!e)},[]),B=(0,a.useCallback)(()=>{M(),null===c||void 0===c||c()},[M,c]),G=(0,a.useCallback)(e=>{var t;const s=null!==(t=e.meta)&&void 0!==t?t:{};if("number"===typeof s.chapterIndex&&n)n(s.chapterIndex);else if("number"===typeof s.scrollToChapter&&n)n(s.scrollToChapter);else if("string"===typeof s.action){if("openExport"===s.action&&l)return void l();if("synthesize-full"===s.action&&i)return void i();if("retry-stage"===s.action&&d)return void d()}},[n,l,i,d]),W=(0,a.useMemo)(()=>{if(!_.length&&!y)return"idle";const e=_[_.length-1];return"success"===(null===e||void 0===e?void 0:e.status)||"error"===(null===e||void 0===e?void 0:e.status)?e.status:null!==y&&void 0!==y&&y.status?y.status:"running"},[_,y]),q="success"===W?pe:"error"===W?he:ve,J=O?"bg-emerald-100 text-emerald-600":"bg-amber-100 text-amber-700",K=O?"bg-emerald-500 animate-pulse":"bg-amber-500";return t?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("button",{type:"button",onClick:F,className:"fixed top-5 right-5 z-50 flex items-center gap-2 rounded-full px-4 py-2 shadow-lg transition md:top-5 md:right-5 ".concat(H),children:[(0,o.jsx)("span",{className:"text-sm font-semibold",children:"\u521b\u4f5c\u8fdb\u5ea6"}),(0,o.jsx)("span",{className:"rounded-full bg-white/70 px-2 py-0.5 text-xs text-slate-700",children:ge[R]})]}),(0,o.jsx)(le.N,{children:f&&(0,o.jsx)(S.P.aside,{initial:{x:360,opacity:0},animate:{x:0,opacity:1},exit:{x:360,opacity:0},transition:{type:"spring",stiffness:220,damping:28},className:"fixed inset-x-0 bottom-0 top-auto z-40 flex h-[78vh] w-full flex-col border-t border-slate-200 bg-white/95 shadow-2xl backdrop-blur md:inset-y-0 md:bottom-0 md:left-auto md:right-0 md:h-full md:max-w-md md:border-l md:border-t-0",children:(0,o.jsxs)("div",{className:"flex h-full flex-col",children:[(0,o.jsxs)("header",{className:"flex items-center justify-between border-b border-slate-100 px-5 py-4",children:[(0,o.jsxs)("div",{className:"space-y-1",children:[(0,o.jsx)("h2",{className:"text-lg font-semibold text-slate-800",children:"\u521b\u4f5c\u8fdb\u5ea6"}),(0,o.jsx)("p",{className:"text-xs text-slate-500",children:s||"\u6545\u4e8b\u751f\u6210\u6d41\u7a0b"}),(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[11px] font-medium ".concat(J),children:[(0,o.jsx)("span",{className:"h-2 w-2 rounded-full ".concat(K)}),O?"\u8fde\u63a5\u6b63\u5e38":"\u81ea\u52a8\u91cd\u8fde\u4e2d"]}),(0,o.jsx)(C,{variant:"ghost",size:"small",onClick:B,icon:(0,o.jsx)(re.A,{className:"h-4 w-4"}),className:"px-3 py-1 text-xs",children:"\u624b\u52a8\u5237\u65b0"})]})]}),(0,o.jsx)("button",{type:"button",onClick:()=>b(!1),className:"rounded-full bg-slate-100 px-3 py-1 text-xs text-slate-600 hover:bg-slate-200",children:"\u5173\u95ed"})]}),(0,o.jsxs)("div",{className:"flex-1 space-y-4 overflow-y-auto px-5 py-4",children:[!O&&(0,o.jsx)("div",{className:"rounded-lg border border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-700",children:"\u4e8b\u4ef6\u6d41\u8fde\u63a5\u4e2d\u65ad\uff0c\u5c06\u81ea\u52a8\u91cd\u8bd5\u3002"}),P&&(0,o.jsx)("div",{className:"rounded-lg border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-600",children:P}),Object.entries(ce).map(e=>{var t,s,a,r,n;let[l,i]=e;const d=null===(t=k[l])||void 0===t?void 0:t.status,c="running"===d||"completed"===d||"failed"===d?d:"pending",u=null!==(s=L[l])&&void 0!==s?s:[],m=u.length>0&&null!==(a=u[u.length-1].meta)&&void 0!==a?a:{},x="number"===typeof m.durationMs?m.durationMs:void 0,p=D[l],h=null!==(r=null===p||void 0===p?void 0:p.commands)&&void 0!==r?r:[],v=null!==p&&void 0!==p&&p.currentCommandId?h.find(e=>e.id===p.currentCommandId):void 0,g=null!==p&&void 0!==p&&p.logs?p.logs.slice(-5):[],f=null!==(n=null===p||void 0===p?void 0:p.artifacts)&&void 0!==n?n:[],b=Boolean(v)||h.length>0||g.length>0||f.length>0;return(0,o.jsxs)(S.P.section,{layout:!0,initial:{opacity:0,scale:.98},animate:{opacity:1,scale:"completed"===c?[1,1.01,1]:1},transition:{duration:.25},className:"rounded-xl border border-slate-100 bg-white p-4 shadow-sm",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsx)("h3",{className:"text-sm font-semibold text-slate-800",children:i}),(0,o.jsx)("span",{className:"rounded-full px-2 py-0.5 text-[10px] uppercase tracking-wide ".concat(ue[c]),children:c})]}),void 0!==x&&(0,o.jsxs)("p",{className:"mt-1 text-[11px] text-slate-500",children:["\u8017\u65f6\u7ea6 ",(x/1e3).toFixed(1)," \u79d2"]}),(0,o.jsx)("div",{className:"mt-3",children:(0,o.jsx)(be,{events:u,onEventAction:G})}),b&&(0,o.jsxs)("div",{className:"mt-4 space-y-4 text-xs text-slate-600",children:[v&&(0,o.jsxs)("div",{className:"rounded-lg border border-blue-100 bg-blue-50/50 px-3 py-2",children:[(0,o.jsx)("p",{className:"text-[11px] font-medium text-blue-700",children:"\u5f53\u524d\u6267\u884c"}),(0,o.jsx)("p",{className:"mt-1 font-semibold text-slate-800",children:v.label}),v.command&&(0,o.jsx)("p",{className:"mt-1 text-[11px] text-slate-500 break-words",children:v.command}),(0,o.jsxs)("div",{className:"mt-2 flex items-center gap-2 text-[11px]",children:[(0,o.jsx)("span",{className:"rounded-full px-2 py-0.5 ".concat(me[v.status]),children:xe[v.status]}),v.startedAt&&(0,o.jsxs)("span",{className:"text-slate-400",children:["\u5f00\u59cb\u4e8e ",fe(v.startedAt)]})]})]}),h.length>0&&(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"text-[11px] font-medium text-slate-500",children:"\u6267\u884c\u8bb0\u5f55"}),(0,o.jsx)("ul",{className:"mt-2 space-y-2",children:h.slice().reverse().map(e=>(0,o.jsxs)("li",{className:"rounded-lg border border-slate-100 bg-slate-50/70 px-3 py-2 shadow-sm",children:[(0,o.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,o.jsx)("span",{className:"text-sm font-semibold text-slate-800",children:e.label}),(0,o.jsx)("span",{className:"whitespace-nowrap rounded-full px-2 py-0.5 text-[10px] uppercase tracking-wide ".concat(me[e.status]),children:xe[e.status]})]}),e.command&&(0,o.jsx)("p",{className:"mt-1 text-[11px] text-slate-500 break-words",children:e.command}),e.resultSummary&&(0,o.jsx)("p",{className:"mt-1 text-[11px] text-slate-500",children:e.resultSummary}),e.errorMessage&&(0,o.jsx)("p",{className:"mt-1 text-[11px] text-rose-600",children:e.errorMessage}),(0,o.jsxs)("div",{className:"mt-1 flex flex-wrap gap-2 text-[10px] text-slate-400",children:[e.startedAt&&(0,o.jsxs)("span",{children:["\u5f00\u59cb ",fe(e.startedAt)]}),e.finishedAt&&(0,o.jsxs)("span",{children:["\u7ed3\u675f ",fe(e.finishedAt)]})]})]},e.id))})]}),g.length>0&&(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"text-[11px] font-medium text-slate-500",children:"\u5b9e\u65f6\u65e5\u5fd7"}),(0,o.jsx)("ul",{className:"mt-2 max-h-44 space-y-1 overflow-y-auto rounded-lg border border-slate-100 bg-white/80 px-3 py-2",children:g.map(e=>{var t;const s=null!==(t=e.level)&&void 0!==t?t:"info",a="error"===s?"text-rose-600":"warn"===s?"text-amber-600":"debug"===s?"text-slate-400":"text-slate-600";return(0,o.jsxs)("li",{className:"text-[11px] leading-5 ".concat(a),children:[(0,o.jsx)("span",{className:"mr-2 text-[10px] text-slate-400",children:fe(e.timestamp)}),e.message]},e.id)})})]}),f.length>0&&(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"text-[11px] font-medium text-slate-500",children:"\u9636\u6bb5\u4ea7\u7269"}),(0,o.jsx)("ul",{className:"mt-2 space-y-2",children:f.map(e=>(0,o.jsxs)("li",{className:"rounded-lg border border-emerald-100 bg-emerald-50/50 px-3 py-2 text-[11px] text-emerald-700",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,o.jsx)("span",{className:"font-semibold text-emerald-800",children:e.label}),(0,o.jsx)("span",{className:"rounded px-2 py-0.5 text-[10px] uppercase text-emerald-600",children:e.type})]}),e.preview&&(0,o.jsx)("pre",{className:"mt-1 max-h-32 whitespace-pre-wrap text-[10px] text-emerald-700/80 overflow-hidden",children:e.preview}),e.url&&(0,o.jsx)("a",{href:e.url,target:"_blank",rel:"noreferrer",className:"mt-2 inline-block text-[11px] text-emerald-700 underline",children:"\u67e5\u770b\u8be6\u60c5"}),(0,o.jsx)("div",{className:"mt-1 text-[10px] text-emerald-400",children:fe(e.createdAt)})]},e.id))})]})]})]},l)}),(0,o.jsxs)("section",{className:"rounded-xl border border-blue-100 bg-blue-50/60 p-4 shadow-sm",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsx)("h3",{className:"text-sm font-semibold text-blue-800",children:"\u8bed\u97f3\u6717\u8bfb"}),(0,o.jsx)("span",{className:"rounded-full px-2 py-0.5 text-[10px] uppercase tracking-wide ".concat(q),children:W})]}),(0,o.jsxs)("div",{className:"mt-3 space-y-2",children:[E&&(0,o.jsx)("p",{className:"text-xs text-blue-700",children:"\u6b63\u5728\u83b7\u53d6\u6700\u65b0\u6717\u8bfb\u4efb\u52a1..."}),N&&(0,o.jsx)("p",{className:"text-xs text-rose-600",children:N}),y&&(0,o.jsxs)("div",{className:"rounded-lg border border-blue-100 bg-white/80 px-3 py-2 text-[11px] text-blue-700",children:[(0,o.jsxs)("p",{children:["\u6700\u8fd1\u4efb\u52a1\uff1a","success"===y.status?"\u6210\u529f":"error"===y.status?"\u5931\u8d25":"\u8fdb\u884c\u4e2d"]}),void 0!==y.segmentIndex&&(0,o.jsxs)("p",{children:["\u7247\u6bb5 #",y.segmentIndex+1]}),y.audioUrl&&(0,o.jsx)("a",{href:y.audioUrl,target:"_blank",rel:"noreferrer",className:"text-xs text-blue-600 underline",children:"\u6253\u5f00\u97f3\u9891\u94fe\u63a5"}),y.error&&(0,o.jsxs)("p",{className:"text-rose-500",children:["\u9519\u8bef\uff1a",y.error]})]}),(0,o.jsx)(be,{events:_,onEventAction:G})]})]}),I.length>0&&(0,o.jsxs)("section",{className:"rounded-xl border border-slate-100 bg-slate-50/70 p-4 shadow-sm",children:[(0,o.jsx)("h3",{className:"text-sm font-semibold text-slate-700",children:"\u7cfb\u7edf\u901a\u77e5"}),(0,o.jsx)("div",{className:"mt-3",children:(0,o.jsx)(be,{events:I,onEventAction:G})})]})]}),(l||i||d)&&(0,o.jsx)("div",{className:"border-t border-slate-200 bg-white/96 px-5 py-4",children:(0,o.jsxs)("div",{className:"flex flex-wrap gap-3",children:[l&&(0,o.jsx)(C,{variant:"secondary",size:"small",onClick:l,loading:x,icon:(0,o.jsx)(se.A,{className:"h-4 w-4"}),children:x?"\u6b63\u5728\u5bfc\u51fa\u2026":"\u5bfc\u51fa\u6545\u4e8b"}),i&&(0,o.jsx)(C,{variant:"primary",size:"small",onClick:i,disabled:p,loading:p,icon:(0,o.jsx)(ae.A,{className:"h-4 w-4"}),children:p?"\u6717\u8bfb\u751f\u6210\u4e2d\u2026":g?"\u91cd\u65b0\u6717\u8bfb\u6574\u7bc7":"\u6717\u8bfb\u6574\u7bc7"}),d&&(0,o.jsx)(C,{variant:"ghost",size:"small",onClick:d,disabled:!v,loading:h,children:"\u91cd\u8bd5\u5931\u8d25\u9636\u6bb5"})]})})]})})})]}):null};var je;const Ne={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!1,REACT_APP_VERSION:"1.0.0",REACT_APP_BUILD_DATE:"2024-01-01",REACT_APP_API_URL:"/api",REACT_APP_DEBUG:"false",REACT_APP_ENABLE_PERFORMANCE_MONITORING:"true",REACT_APP_PREFETCH_ASSETS:"true"}.REACT_APP_TTS_VOICE_ID||{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!1,REACT_APP_VERSION:"1.0.0",REACT_APP_BUILD_DATE:"2024-01-01",REACT_APP_API_URL:"/api",REACT_APP_DEBUG:"false",REACT_APP_ENABLE_PERFORMANCE_MONITORING:"true",REACT_APP_PREFETCH_ASSETS:"true"}.REACT_APP_TTS_VOICE||"iflytek_yeting",we=Number(null!==(je={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!1,REACT_APP_VERSION:"1.0.0",REACT_APP_BUILD_DATE:"2024-01-01",REACT_APP_API_URL:"/api",REACT_APP_DEBUG:"false",REACT_APP_ENABLE_PERFORMANCE_MONITORING:"true",REACT_APP_PREFETCH_ASSETS:"true"}.REACT_APP_TTS_SPEED)&&void 0!==je?je:"1"),Se=new Set(["timeline-from-text","chapter-time-tags","motive-foreshadowing"]),Ee=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function Ae(){var e,t,s,r,n,i,d,u,m,v,g,f,b,y;const{workflowId:j}=(0,l.g)(),N=(0,l.Zp)(),w=(0,l.zy)().state,S=null===w||void 0===w?void 0:w.workflow,{workflow:E,isLoading:A,error:k,refresh:R}=I(j,S),P=(null===E||void 0===E?void 0:E._id)||j||void 0,D=null!==(e=null===w||void 0===w?void 0:w.openTimeline)&&void 0!==e?e:Boolean(P),[L,H]=(0,a.useState)(!1),[U,z]=(0,a.useState)(0),[V,B]=(0,a.useState)(null),[G,W]=(0,a.useState)(""),[q,J]=(0,a.useState)({mode:"none"}),[K,le]=(0,a.useState)(!1),[ie,oe]=(0,a.useState)(null),[de,ce]=(0,a.useState)(null),[ue,me]=(0,a.useState)(D),[xe,pe]=(0,a.useState)(!1),{synthesizeStory:he,status:ve,error:ge}=Y({defaultVoiceId:Ne,defaultSpeed:we});(0,a.useEffect)(()=>{k&&h.Ay.error(k)},[k]),(0,a.useEffect)(()=>{ge&&h.Ay.error(ge)},[ge]),(0,a.useEffect)(()=>{me(D)},[D]);const fe=(0,a.useMemo)(()=>{var e,t;return null!==(e=null===E||void 0===E||null===(t=E.storyDraft)||void 0===t?void 0:t.chapters)&&void 0!==e?e:[]},[null===E||void 0===E||null===(t=E.storyDraft)||void 0===t?void 0:t.chapters]),be=(0,a.useMemo)(()=>function(e){if(!e||!Array.isArray(e.chapters))return"";const t=[];return e.chapters.forEach((e,s)=>{const a=$(s,e);t.push("## \u7b2c".concat(s+1,"\u7ae0 ").concat(a)),t.push("");const r=Z(null===e||void 0===e?void 0:e.content);t.push(r||""),t.push("")}),t.join("\n")}(null===E||void 0===E?void 0:E.storyDraft),[null===E||void 0===E?void 0:E.storyDraft]),je=null===E||void 0===E||null===(s=E.validation)||void 0===s?void 0:s.summary,Ae=(0,a.useMemo)(()=>{var e,t;return null!==(e=null===E||void 0===E||null===(t=E.validation)||void 0===t?void 0:t.results)&&void 0!==e?e:[]},[null===E||void 0===E||null===(r=E.validation)||void 0===r?void 0:r.results]),Ce=null!==(n=null===E||void 0===E||null===(i=E.outline)||void 0===i?void 0:i.timeline)&&void 0!==n?n:[],Te=null!==(d=null===E||void 0===E||null===(u=E.outline)||void 0===u?void 0:u.characters)&&void 0!==d?d:[],ke=null!==(m=null===E||void 0===E||null===(v=E.outline)||void 0===v?void 0:v.clueMatrix)&&void 0!==m?m:[],_e=null!==(g=null===E||void 0===E||null===(f=E.storyDraft)||void 0===f?void 0:f.revisionNotes)&&void 0!==g?g:[],Ie=null!==(b=null===E||void 0===E||null===(y=E.storyDraft)||void 0===y?void 0:y.continuityNotes)&&void 0!==b?b:[],Re=(0,a.useMemo)(()=>({fails:Ae.filter(e=>"fail"===e.status),warns:Ae.filter(e=>"warn"===e.status),passes:Ae.filter(e=>"pass"===e.status)}),[Ae]),Oe=(0,a.useMemo)(()=>Re.warns.filter(e=>Se.has(e.ruleId)),[Re.warns]),Pe=Re.warns.length>0,Me=Re.fails.length>0,De=Oe.length>0,Le=()=>N("/"),He=(null===E||void 0===E?void 0:E.topic)||"\u4fa6\u63a2\u6545\u4e8b",Ue=Boolean(k)&&!E,ze="loading"===ve,Fe=(0,a.useMemo)(()=>fe.length?Math.min(100,Math.round((U+1)/fe.length*100)):0,[fe.length,U]),Ve=L?"bg-slate-900/80 border-white/10 text-slate-100":void 0,Be=(0,a.useMemo)(()=>{var e;return(null!==(e=null===E||void 0===E?void 0:E.stageStates)&&void 0!==e?e:[]).some(e=>"failed"===e.status)},[null===E||void 0===E?void 0:E.stageStates]),Ge=(0,a.useMemo)(()=>{const e=[];return L&&e.push("bg-slate-950 text-slate-100 transition-colors duration-300"),ue&&e.push("md:pr-[340px]"),e.join(" ")},[L,ue]),We=L?"text-slate-100":void 0,qe=(0,a.useCallback)(()=>{if(!fe.length)return()=>{};const e=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const t=e.target.getAttribute("data-index");t&&z(Number(t))}})},{rootMargin:"-40% 0px -40% 0px",threshold:[.25,.5,.75]});return document.querySelectorAll('[data-reader-chapter="true"]').forEach(t=>e.observe(t)),()=>e.disconnect()},[fe.length]);(0,a.useEffect)(()=>qe(),[qe]);const Je=(0,a.useCallback)(e=>{const t=document.querySelector('[data-reader-chapter="true"][data-index="'.concat(e,'"]'));t&&t.scrollIntoView({behavior:"smooth",block:"start"})},[]),Ke=async()=>{if(P)if(be.trim()){if(Me)return W("\u8bf7\u5148\u4fee\u590d\u6821\u9a8c\u5931\u8d25\u9879\u540e\u518d\u5c1d\u8bd5\u6717\u8bfb\u751f\u6210\u3002"),void h.Ay.error("\u6545\u4e8b\u6821\u9a8c\u5b58\u5728\u672a\u89e3\u51b3\u7684\u5931\u8d25\u9879\uff0c\u65e0\u6cd5\u751f\u6210\u6717\u8bfb\u97f3\u9891");if(Pe)return W("\u6821\u9a8c\u4ecd\u6709\u8b66\u544a\uff0c\u8bf7\u5b8c\u6210\u4fee\u8ba2\u540e\u518d\u751f\u6210\u6717\u8bfb\u97f3\u9891\u3002"),void h.Ay.error("\u6821\u9a8c\u4ecd\u6709\u8b66\u544a\uff0c\u8bf7\u5b8c\u6210\u4fee\u8ba2\u540e\u518d\u5c1d\u8bd5\u6717\u8bfb");try{J({mode:"full"}),W("\u6b63\u5728\u5408\u6210\u6574\u7bc7\u6717\u8bfb\uff0c\u9884\u8ba1\u8017\u65f6 20-40 \u79d2\u2026");const e=await he({storyId:P||"story-".concat(Date.now()),fullText:be,chapterMarkers:fe.map((e,t)=>$(t,e)),voiceId:Ne,speed:we});B(e),e.successCount===e.totalSegments?(W("\u6717\u8bfb\u97f3\u9891\u5df2\u5c31\u7eea\uff0c\u53ef\u5f00\u59cb\u64ad\u653e\u3002"),h.Ay.success("\u6574\u7bc7\u6717\u8bfb\u5df2\u751f\u6210")):(W("\u90e8\u5206\u6bb5\u843d\u5408\u6210\u5931\u8d25\uff0c\u53ef\u7a0d\u540e\u91cd\u8bd5\u3002"),h.Ay.error("\u90e8\u5206\u6717\u8bfb\u7247\u6bb5\u751f\u6210\u5931\u8d25"))}catch(e){const t=(null===e||void 0===e?void 0:e.message)||"\u6717\u8bfb\u5408\u6210\u5931\u8d25";W(""),h.Ay.error(t)}}else h.Ay.error("\u5c1a\u65e0\u53ef\u6717\u8bfb\u7684\u6b63\u6587\u5185\u5bb9");else h.Ay.error("\u6545\u4e8b ID \u7f3a\u5931\uff0c\u65e0\u6cd5\u751f\u6210\u6717\u8bfb\u97f3\u9891")},Ye=V?V.segments.filter(e=>e.cached).length:0,Ze=(0,a.useMemo)(()=>"full"===q.mode?He:"",[fe,He,q]),$e=async()=>{if(P){le(!0),ce(null);try{const e=await async function(e){return _("/api/story-workflows/".concat(e,"/compile"),{method:"POST",body:JSON.stringify({})})}(P);oe(e),h.Ay.success("\u5df2\u751f\u6210\u6545\u4e8b\u5bfc\u51fa\u6587\u4ef6")}catch(e){const t=(null===e||void 0===e?void 0:e.message)||"\u5bfc\u51fa\u5931\u8d25";ce(t),h.Ay.error(t)}finally{le(!1)}}else h.Ay.error("\u5f53\u524d\u6545\u4e8b\u65e0\u6cd5\u5bfc\u51fa\uff08\u7f3a\u5c11 ID\uff09")},Qe=(0,a.useCallback)(async()=>{if(P)try{var e;pe(!0);const t=await async function(e){return _("/api/story-workflows/".concat(e,"/retry"),{method:"POST"})}(P),s=null!==(e=null===t||void 0===t?void 0:t.workflowId)&&void 0!==e?e:P;h.Ay.success("\u5df2\u91cd\u65b0\u89e6\u53d1\u6545\u4e8b\u751f\u6210\u6d41\u7a0b"),N("/story/".concat(s),{replace:!0,state:{openTimeline:!0}})}catch(t){const e=(null===t||void 0===t?void 0:t.message)||"\u91cd\u8bd5\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5";h.Ay.error(e)}finally{pe(!1)}else h.Ay.error("\u5f53\u524d\u6545\u4e8b\u65e0\u6cd5\u91cd\u8bd5\uff08\u7f3a\u5c11 ID\uff09")},[P,N]),Xe=(0,a.useCallback)(e=>{V||(W("\u540e\u53f0\u6717\u8bfb\u4efb\u52a1\u5df2\u5b8c\u6210\uff0c\u53ef\u70b9\u51fb\u201c\u6717\u8bfb\u6574\u7bc7\u201d\u91cd\u65b0\u83b7\u53d6\u97f3\u9891\u3002"),h.Ay.success("\u6717\u8bfb\u4efb\u52a1\u5df2\u5b8c\u6210\uff0c\u53ef\u70b9\u51fb\u201c\u6717\u8bfb\u6574\u7bc7\u201d\u83b7\u53d6\u97f3\u9891\u3002"))},[V]),et=(0,o.jsx)(C,{variant:"ghost",size:"small",onClick:()=>H(e=>!e),children:L?(0,o.jsxs)("span",{className:"flex items-center gap-1",children:[(0,o.jsx)(Q.A,{className:"h-4 w-4"})," \u9000\u51fa\u591c\u95f4"]}):(0,o.jsxs)("span",{className:"flex items-center gap-1",children:[(0,o.jsx)(X.A,{className:"h-4 w-4"})," \u591c\u95f4\u6a21\u5f0f"]})});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(ye,{workflowId:P,storyTitle:He,initialOpen:D,onOpenChange:me,onScrollToChapter:Je,onRequestExport:$e,onRequestReadFull:Ke,onRetryFailedStage:Qe,onManualRefresh:R,isExporting:K,isSynthesizing:ze,hasFailedStage:Be,isRetryingStage:xe,isTtsReady:Boolean(V),onTtsEventSuccess:Xe}),(0,o.jsx)(x,{maxWidth:"3xl",className:Ge||void 0,containerClassName:We,topBar:(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2 text-points-primary",children:[(0,o.jsx)(M.A,{className:"h-5 w-5"}),(0,o.jsx)("span",{className:"font-semibold",children:"\u6545\u4e8b\u9605\u8bfb"})]}),(0,o.jsxs)("div",{className:"flex gap-2",children:[et,(0,o.jsxs)(C,{variant:"ghost",size:"small",onClick:Le,children:[(0,o.jsx)(ee.A,{className:"mr-1 h-4 w-4"}),"\u8fd4\u56de\u9996\u9875"]}),(0,o.jsx)(C,{variant:"ghost",size:"small",onClick:()=>N("/builder"),children:"\u9ad8\u7ea7\u6a21\u5f0f"})]})]}),children:A?(0,o.jsxs)("div",{className:"flex flex-col items-center justify-center py-32 text-points-text-muted",children:[(0,o.jsx)(T,{size:"medium"}),(0,o.jsx)("p",{className:"mt-4",children:"\u6545\u4e8b\u751f\u6210\u8f83\u590d\u6742\uff0c\u6b63\u5728\u52a0\u8f7d\u6821\u9a8c\u5b8c\u6210\u7684\u7248\u672c\u2026"})]}):Ue?(0,o.jsxs)(p,{layout:"card",className:Ve+" text-center",children:[(0,o.jsx)(te.A,{className:"mx-auto mb-3 h-8 w-8 text-red-500"}),(0,o.jsx)("p",{className:"text-points-text-muted",children:k}),(0,o.jsx)("div",{className:"mt-4",children:(0,o.jsx)(C,{variant:"primary",onClick:Le,children:"\u8fd4\u56de\u9996\u9875"})})]}):(0,o.jsxs)("div",{className:"space-y-6",children:[(0,o.jsxs)(p,{layout:"card",className:Ve,actions:(0,o.jsx)("div",{className:"flex flex-wrap gap-2",children:(0,o.jsx)(C,{variant:"primary",size:"small",onClick:$e,disabled:K,children:K?(0,o.jsxs)("span",{className:"flex items-center gap-2",children:[(0,o.jsx)(T,{size:"small"})," \u6b63\u5728\u5bfc\u51fa\u2026"]}):(0,o.jsxs)("span",{className:"flex items-center gap-2",children:[(0,o.jsx)(se.A,{className:"h-4 w-4"})," \u5bfc\u51fa\u6545\u4e8b"]})})}),children:[(0,o.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("h1",{className:"text-3xl font-bold text-points-text",children:He}),(0,o.jsx)("p",{className:"mt-2 text-sm text-points-text-muted",children:"\u6545\u4e8b\u7531 5 \u4e2a\u9636\u6bb5\u751f\u6210\u5b8c\u6210\uff08\u542b\u81ea\u52a8\u4fee\u8ba2\u4e0e\u516c\u5e73\u6027\u6821\u9a8c\uff09\uff0c\u5df2\u81ea\u52a8\u5d4c\u5165\u7ebf\u7d22\u63d0\u793a\u3002"})]}),je&&(0,o.jsxs)("div",{className:"rounded-2xl bg-points-bg px-4 py-3 text-sm text-points-text-muted",children:[(0,o.jsx)("span",{className:"font-semibold text-points-primary",children:"\u6821\u9a8c\u7edf\u8ba1\uff1a"}),(0,o.jsxs)("span",{className:"ml-2",children:["Pass ",je.pass]}),(0,o.jsxs)("span",{className:"ml-2",children:["Warn ",je.warn]}),(0,o.jsxs)("span",{className:"ml-2",children:["Fail ",je.fail]})]})]}),(0,o.jsxs)("div",{className:"mt-4",children:[(0,o.jsx)("div",{className:"h-2 w-full overflow-hidden rounded-full bg-points-border/50",children:(0,o.jsx)("div",{className:"h-full rounded-full bg-points-primary transition-all",style:{width:"".concat(Fe,"%")}})}),(0,o.jsxs)("p",{className:"mt-2 text-xs text-points-text-muted",children:["\u9605\u8bfb\u8fdb\u5ea6\uff1a\u7b2c ",Math.min(U+1,fe.length)," / ",fe.length," \u7ae0\uff08",Fe,"%\uff09"]})]}),ie&&(0,o.jsxs)("div",{className:"mt-4 space-y-2 text-xs text-points-text-muted",children:[(0,o.jsx)("p",{children:"\u5bfc\u51fa\u5b8c\u6210\uff0c\u53ef\u4e0b\u8f7d\uff1a"}),(0,o.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,o.jsx)("a",{className:"text-points-primary underline",href:ie.urls.plain,target:"_blank",rel:"noreferrer",children:"\u7eaf\u6587\u672c"}),(0,o.jsx)("a",{className:"text-points-primary underline",href:ie.urls.html,target:"_blank",rel:"noreferrer",children:"HTML \u9884\u89c8"}),(0,o.jsx)("a",{className:"text-points-primary underline",href:ie.urls.interactive,target:"_blank",rel:"noreferrer",children:"\u4e92\u52a8\u5305 JSON"})]})]}),de&&(0,o.jsx)("p",{className:"mt-2 text-xs text-red-500",children:de})]}),(0,o.jsxs)(p,{title:"\u8bed\u97f3\u6717\u8bfb",layout:"card",className:Ve,actions:(0,o.jsx)(C,{variant:"primary",size:"small",onClick:Ke,disabled:ze||!be.trim(),children:ze&&"full"===q.mode?(0,o.jsxs)("span",{className:"flex items-center gap-2",children:[(0,o.jsx)(T,{size:"small"})," \u6b63\u5728\u751f\u6210\u6717\u8bfb\u97f3\u9891\u2026"]}):(0,o.jsxs)("span",{className:"flex items-center gap-2",children:[(0,o.jsx)(ae.A,{className:"h-4 w-4"})," \u6717\u8bfb\u6574\u7bc7"]})}),children:[G&&(0,o.jsx)("p",{className:"text-xs text-points-text-muted",children:G}),V&&(0,o.jsxs)("div",{className:"mt-4 space-y-3",children:[Ze&&(0,o.jsxs)("p",{className:"text-sm text-points-text-muted",children:["\u5f53\u524d\u6717\u8bfb\uff1a",Ze]}),(0,o.jsx)(F,{storyId:V.storyId,segments:V.segments,totalDuration:V.totalDuration}),(0,o.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs text-points-text-muted",children:[(0,o.jsxs)("span",{children:["\u5206\u6bb5\u6570\uff1a",V.totalSegments]}),(0,o.jsxs)("span",{children:["\u7f13\u5b58\u547d\u4e2d\uff1a",Ye,"/",V.totalSegments]}),(0,o.jsxs)(C,{variant:"ghost",size:"small",onClick:()=>{B(null),W(""),J({mode:"none"})},children:[(0,o.jsx)(re.A,{className:"mr-1 h-4 w-4"})," \u6e05\u7a7a\u6717\u8bfb\u7ed3\u679c"]})]}),V.segments.some(e=>e.error)&&(0,o.jsxs)("div",{className:"rounded-xl bg-red-50 px-4 py-3 text-xs text-red-600",children:["\u90e8\u5206\u6bb5\u843d\u5408\u6210\u5931\u8d25\uff1a",V.segments.filter(e=>e.error).map(e=>(0,o.jsxs)("div",{children:["\u7b2c ",e.segmentIndex+1," \u6bb5 ",e.chapterTitle?"\xb7 ".concat(e.chapterTitle):""," \u2014 ",e.error]},e.segmentIndex))]})]})]}),fe.length>0&&(0,o.jsx)(p,{title:"\u7ae0\u8282\u76ee\u5f55",layout:"card",className:Ve,children:(0,o.jsx)("div",{className:"flex flex-wrap gap-2",children:fe.map((e,t)=>(0,o.jsxs)("button",{type:"button",onClick:()=>Je(t),className:"rounded-full border px-3 py-1 text-sm transition ".concat(t===U?"border-points-primary bg-points-primary/10 text-points-primary":"border-points-border text-points-text-muted hover:border-points-primary hover:text-points-primary"),children:[t+1,". ",$(t,e)]},e.title||t))})}),Ce.length>0&&(0,o.jsx)(p,{title:"\u65f6\u95f4\u7ebf",layout:"card",className:Ve,children:(0,o.jsx)("div",{className:"space-y-3",children:Ce.map((e,t)=>(0,o.jsxs)("div",{className:"flex items-start gap-3 rounded-2xl bg-points-bg px-4 py-3",children:[(0,o.jsx)(O.A,{className:"mt-1 h-4 w-4 text-points-primary"}),(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"text-sm font-semibold text-points-text",children:e.time}),(0,o.jsx)("p",{className:"text-sm text-points-text-muted",children:e.event})]})]},"".concat(e.time,"-").concat(t)))})}),Te.length>0&&(0,o.jsx)(p,{title:"\u4e3b\u8981\u4eba\u7269",layout:"card",className:Ve,children:(0,o.jsx)("div",{className:"grid gap-3 md:grid-cols-2",children:Te.map((e,t)=>(0,o.jsxs)("div",{className:"rounded-2xl bg-points-bg px-4 py-3",children:[(0,o.jsx)("p",{className:"text-sm font-semibold text-points-text",children:e.name}),(0,o.jsxs)("p",{className:"text-xs text-points-text-muted",children:["\u89d2\u8272\uff1a",e.role||"\u672a\u77e5"]}),e.motive&&(0,o.jsxs)("p",{className:"mt-2 text-xs text-points-text-muted",children:["\u52a8\u673a\uff1a",e.motive]})]},"".concat(e.name,"-").concat(t)))})}),ke.length>0&&(0,o.jsx)(p,{title:"\u7ebf\u7d22\u4e00\u89c8",layout:"card",className:Ve,children:(0,o.jsx)("div",{className:"space-y-3",children:ke.map((e,t)=>(0,o.jsxs)("div",{className:"rounded-2xl bg-points-bg px-4 py-3",children:[(0,o.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,o.jsx)("p",{className:"text-sm font-semibold text-points-text",children:e.clue}),e.isRedHerring&&(0,o.jsx)("span",{className:"rounded-full bg-amber-100 px-2 py-0.5 text-xs font-semibold text-amber-700",children:"\u7ea2\u9cb1\u9c7c"})]}),e.surfaceMeaning&&(0,o.jsxs)("p",{className:"text-xs text-points-text-muted",children:["\u8868\u9762\u4fe1\u606f\uff1a",e.surfaceMeaning]}),e.realMeaning&&(0,o.jsxs)("p",{className:"text-xs text-points-text-muted",children:["\u771f\u5b9e\u6307\u5411\uff1a",e.realMeaning]}),e.explicitForeshadowChapters&&e.explicitForeshadowChapters.length>0&&(0,o.jsxs)("p",{className:"text-xs text-points-text-muted",children:["\u94fa\u57ab\u7ae0\u8282\uff1a",e.explicitForeshadowChapters.join("\u3001")]}),"number"===typeof e.appearsAtAct&&(0,o.jsxs)("p",{className:"text-xs text-points-text-muted",children:["\u9996\u6b21\u51fa\u73b0\u5e55\u6b21\uff1aAct ",e.appearsAtAct]})]},"".concat(e.clue,"-").concat(t)))})}),_e.length>0&&(0,o.jsxs)(p,{title:"\u4fee\u8ba2\u8bf4\u660e",layout:"card",className:"".concat(null!==Ve&&void 0!==Ve?Ve:""," ").concat(Pe?"border border-amber-400/70 bg-amber-50 text-amber-900 dark:border-amber-300 dark:bg-amber-900/30 dark:text-amber-100":"").trim(),children:[Pe&&(0,o.jsxs)("div",{className:"mb-3 rounded-xl bg-amber-100 px-3 py-2 text-xs text-amber-800 dark:bg-amber-900/50 dark:text-amber-200",children:["\u26a0\ufe0f \u6821\u9a8c\u4ecd\u6709 ",Re.warns.length," \u9879\u8b66\u544a",De&&(0,o.jsxs)(o.Fragment,{children:["\uff0c\u5176\u4e2d\u91cd\u70b9\u4fee\u590d\uff1a",Oe.map(e=>{var t;return(Array.isArray(e.details)&&e.details.length>0?null===(t=e.details[0])||void 0===t?void 0:t.message:e.ruleId)||e.ruleId}).join("\uff1b")]}),"\u3002\u8bf7\u6839\u636e\u63d0\u793a\u7ee7\u7eed\u4fee\u8ba2\u5e76\u91cd\u65b0\u8fd0\u884c\u751f\u6210\u6d41\u7a0b\u3002"]}),(0,o.jsx)("ul",{className:"list-disc space-y-1 pl-5 text-xs ".concat(Pe?"text-amber-900 dark:text-amber-100":"text-points-text-muted"),children:_e.map((e,t)=>(0,o.jsx)("li",{children:e},"revision-note-".concat(t)))})]}),Ie.length>0&&(0,o.jsx)(p,{title:"\u8fde\u7eed\u6027\u63d0\u9192",layout:"card",className:Ve,children:(0,o.jsx)("ul",{className:"list-disc space-y-1 pl-5 text-xs text-points-text-muted",children:Ie.map((e,t)=>(0,o.jsx)("li",{children:e},"continuity-note-".concat(t)))})}),Ae.length>0&&(0,o.jsxs)(p,{title:"\u6821\u9a8c\u63d0\u9192",layout:"card",className:Ve,children:[0===Re.fails.length&&0===Re.warns.length?(0,o.jsx)("p",{className:"text-sm text-points-text-muted",children:"\u6240\u6709\u6821\u9a8c\u89c4\u5219\u5747\u5df2\u901a\u8fc7\uff0c\u65e0\u9700\u989d\u5916\u5904\u7406\u3002"}):(0,o.jsx)("div",{className:"space-y-3",children:[...Re.fails,...Re.warns].map(e=>{const t=Array.isArray(e.details)&&e.details.length>0?e.details.map((t,s)=>(0,o.jsx)("li",{className:"leading-5",children:t.message},"".concat(e.ruleId,"-detail-").concat(s))):null,s="warn"===e.status&&Se.has(e.ruleId),a="fail"===e.status?"\u9700\u4fee\u590d":s?"\u5fc5\u987b\u4fee\u590d":"\u9700\u5173\u6ce8",r="fail"===e.status?"bg-rose-100 text-rose-700":s?"bg-amber-200 text-amber-900":"bg-amber-100 text-amber-700";return(0,o.jsxs)("div",{className:"rounded-2xl border px-4 py-3 ".concat(s?"border-amber-300 bg-amber-50 text-amber-900 dark:border-amber-200 dark:bg-amber-900/40 dark:text-amber-100":"border-points-border"),children:[(0,o.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,o.jsx)("span",{className:"rounded-full px-2 py-0.5 text-xs font-semibold ".concat(r),children:a}),(0,o.jsx)("span",{className:"text-xs text-points-text-muted",children:e.ruleId})]}),t?(0,o.jsx)("ul",{className:"mt-2 list-disc space-y-1 pl-4 text-xs text-points-text-muted",children:t}):(0,o.jsx)("p",{className:"mt-2 text-xs text-points-text-muted",children:"\u6821\u9a8c\u5668\u672a\u63d0\u4f9b\u5177\u4f53\u8bf4\u660e\u3002"})]},e.ruleId)})}),Re.passes.length>0&&(0,o.jsxs)("p",{className:"mt-3 text-xs text-points-text-muted",children:["\u53e6\u6709 ",Re.passes.length," \u9879\u89c4\u5219\u5df2\u901a\u8fc7\u3002"]})]}),(0,o.jsx)(p,{title:"\u6545\u4e8b\u6b63\u6587",layout:"card",className:Ve,children:(0,o.jsx)("div",{className:"space-y-8",children:0===fe.length?(0,o.jsx)("p",{className:"text-sm text-points-text-muted",children:"\u6682\u65e0\u7ae0\u8282\u5185\u5bb9\u3002"}):fe.map((e,t)=>{const s=function(e){const t=Z(null===e||void 0===e?void 0:e.content);if(!t)return[(0,o.jsx)(a.Fragment,{children:"\uff08\u672c\u7ae0\u6682\u65e0\u6b63\u6587\uff09"},"empty")];const s=new Map;if((e.cluesEmbedded||[]).forEach(e=>{e&&s.set(e,{type:"clue"})}),(e.redHerringsEmbedded||[]).forEach(e=>{e&&(s.has(e)||s.set(e,{type:"redHerring"}))}),0===s.size)return[t];const r=Array.from(s.keys()).sort((e,t)=>t.length-e.length),n=new RegExp("(".concat(r.map(Ee).join("|"),")"),"g");return t.split(n).map((e,t)=>{const r=s.get(e);if(!r)return(0,o.jsx)(a.Fragment,{children:e},"seg-".concat(t));const n="clue"===r.type?"rounded bg-emerald-100 px-1 text-emerald-800 shadow-inner":"rounded bg-amber-100 px-1 text-amber-800 shadow-inner",l="clue"===r.type?"clue-highlight":"red-herring-highlight";return(0,o.jsx)("span",{className:n,"data-testid":l,children:e},"seg-".concat(t))})}(e),r=Array.from(new Set((e.cluesEmbedded||[]).filter(Boolean))),n=Array.from(new Set((e.redHerringsEmbedded||[]).filter(Boolean)));return(0,o.jsxs)("article",{"data-reader-chapter":"true","data-index":t,className:"scroll-mt-24",children:[(0,o.jsxs)("h2",{className:"text-2xl font-semibold text-points-text",children:["\u7b2c",t+1,"\u7ae0 ",$(t,e)]}),(0,o.jsx)("p",{className:"mt-2 whitespace-pre-line text-base leading-7 text-points-text",children:s}),(r.length>0||n.length>0)&&(0,o.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2 text-xs",children:[r.map(e=>(0,o.jsxs)("span",{className:"rounded-full bg-emerald-50 px-2 py-0.5 text-emerald-700",children:["\u7ebf\u7d22\uff1a",e]},"clue-".concat(e))),n.map(e=>(0,o.jsxs)("span",{className:"rounded-full bg-amber-50 px-2 py-0.5 text-amber-700",children:["\u8bef\u5bfc\uff1a",e]},"red-".concat(e)))]})]},t)})})}),(0,o.jsx)(p,{layout:"card",className:Ve,children:(0,o.jsxs)("div",{className:"flex flex-wrap gap-3 text-sm text-points-text-muted",children:[(0,o.jsx)(c,{variant:"success",icon:(0,o.jsx)(ne.A,{className:"h-4 w-4"}),children:"\u6545\u4e8b\u751f\u6210\u5b8c\u6210"}),(0,o.jsxs)(c,{children:[fe.length," \u4e2a\u7ae0\u8282"]}),(null===E||void 0===E?void 0:E.validation)&&(0,o.jsxs)(c,{children:["\u6821\u9a8c\u89c4\u5219 ",E.validation.results.length," \u9879"]}),V&&(0,o.jsxs)(c,{children:["\u6717\u8bfb\u5206\u6bb5 ",V.totalSegments,"\uff08\u7f13\u5b58 ",Ye,"\uff09"]})]})})]})})]})}var Ce=s(682);const Te=[{label:"\u6807\u51c6\u5267\u672c",values:{avgSentenceLen:22,misdirectionCap:.3,dialoguesMin:6,sensoryHooks:2,themeAnchors:"\u6d77\u96fe,\u6f6e\u58f0,\u53e4\u5854,\u661f\u5149,\u79d8\u5bc6",wordsPerScene:1200,ch1MinClues:3,minExposures:2}},{label:"\u60c5\u7eea\u5f3a\u5316",values:{avgSentenceLen:22,misdirectionCap:.25,dialoguesMin:8,sensoryHooks:4,themeAnchors:"\u5fc3\u8df3,\u96e8\u58f0,\u5fae\u5149,\u62e5\u62b1,\u52c7\u6c14",wordsPerScene:1300,ch1MinClues:3,minExposures:2}},{label:"\u63a8\u7406\u7126\u70b9",values:{avgSentenceLen:21,misdirectionCap:.2,dialoguesMin:7,sensoryHooks:2,themeAnchors:"\u8bc1\u636e,\u63a8\u7406,\u65f6\u95f4\u7ebf,\u771f\u76f8,\u4f0f\u7b14",wordsPerScene:1100,ch1MinClues:4,minExposures:3}}],ke="custom",_e=Ce.DETECTIVE_MECHANISM_PRESETS[0];function Ie(){var e,t;const[s,r]=a.useState("\u96fe\u5c9a\u53e4\u5821\u7684\u7b2c\u516b\u58f0"),[n,l]=a.useState("balanced"),[i,d]=a.useState("seed-demo"),[c,u]=a.useState(null),[m,x]=a.useState(null),[p,h]=a.useState(null),[v,f]=a.useState("S3"),[b,y]=a.useState(null),[j,N]=a.useState(!1),[w,S]=a.useState(null),[E,A]=a.useState(null),[C,T]=a.useState(null),[k,I]=a.useState("reader"),[R,O]=a.useState("middle_grade"),[P,M]=a.useState(22),[D,L]=a.useState(1200),[H,U]=a.useState(2),[z,F]=a.useState(2),[V,B]=a.useState(.3),[G,W]=a.useState(6),[q,J]=a.useState(2),[K,Y]=a.useState("\u6d77\u96fe,\u6f6e\u58f0,\u53e4\u5854,\u661f\u5149,\u79d8\u5bc6"),[Q,X]=a.useState(null!==(e=null===_e||void 0===_e?void 0:_e.id)&&void 0!==e?e:""),[ee,te]=a.useState(""),[se,ae]=a.useState(!0),[re,ne]=a.useState(2),[le,ie]=a.useState("medium"),oe=a.useMemo(()=>Q===ke?null:Ce.DETECTIVE_MECHANISM_PRESETS.find(e=>e.id===Q)||null,[Q]),de=a.useMemo(()=>function(e){if(!e||!Array.isArray(e.chapters))return"";const t=[];return e.chapters.forEach((e,s)=>{const a=$(s,e),r=Z(null===e||void 0===e?void 0:e.content);t.push("\u7b2c".concat(s+1,"\u7ae0 ").concat(a)),t.push(r||"\uff08\u672c\u7ae0\u6682\u65e0\u6b63\u6587\uff09"),t.push("")}),t.join("\n")}(E),[E]),ce=(null===C||void 0===C?void 0:C.plainText)||de,ue=a.useRef({readingLevel:"middle_grade",targets:{avgSentenceLen:22,wordsPerScene:1200},cluePolicy:{ch1MinClues:2,minExposures:2},misdirectionCap:.3,writer:{dialoguesMin:6,sensoryHooks:2,themeAnchors:["\u6d77\u96fe","\u6f6e\u58f0","\u53e4\u5854","\u661f\u5149","\u79d8\u5bc6"]},deviceKeywords:_e?_e.keywords:[],deviceRealismHint:null!==(t=null===_e||void 0===_e?void 0:_e.realismHint)&&void 0!==t?t:"\u8bf7\u63cf\u8ff0\u8be5\u673a\u5173\u7684\u73b0\u5b9e\u539f\u7406\uff08\u52a8\u529b\u6765\u6e90\u3001\u6750\u6599\u6216\u53ef\u4ee5\u53c2\u8003\u7684\u88c5\u7f6e\uff09\u3002",mechanismId:null===_e||void 0===_e?void 0:_e.id,mechanismLabel:null===_e||void 0===_e?void 0:_e.label,useReasoner:!0,reasoner:{candidates:2,effort:"medium",judge:"rules"}});return a.useEffect(()=>{var e,t,s;const a=K.split(",").map(e=>e.trim()).filter(Boolean),r=Q===ke?null:oe,n=Q===ke?ee.split(/[,\uff0c\u3001\s]+/).map(e=>e.trim()).filter(Boolean):null!==(e=null===r||void 0===r?void 0:r.keywords)&&void 0!==e?e:[],l=Q===ke?"\u8bf7\u63cf\u8ff0\u8be5\u673a\u5173\u7684\u73b0\u5b9e\u539f\u7406\uff08\u52a8\u529b\u6765\u6e90\u3001\u6750\u6599\u6216\u53ef\u4ee5\u53c2\u8003\u7684\u88c5\u7f6e\uff09\u3002":null!==(t=null===r||void 0===r?void 0:r.realismHint)&&void 0!==t?t:"";ue.current={readingLevel:R,targets:{avgSentenceLen:P,wordsPerScene:D},cluePolicy:{ch1MinClues:H,minExposures:z},misdirectionCap:V,writer:{dialoguesMin:G,sensoryHooks:q,themeAnchors:a},deviceKeywords:n,deviceRealismHint:l,mechanismId:Q,mechanismLabel:null!==(s=null===r||void 0===r?void 0:r.label)&&void 0!==s?s:"\u81ea\u5b9a\u4e49\u5173\u952e\u8bcd",useReasoner:se,reasoner:{candidates:re,effort:le,judge:"rules"}}},[R,P,D,H,z,V,G,q,K,Q,ee,oe,se,re,le]),(0,o.jsx)("div",{className:"min-h-screen bg-slate-50 text-slate-800",children:(0,o.jsxs)("div",{className:"max-w-6xl mx-auto py-10 px-4",children:[(0,o.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"\u4fa6\u63a2\u6545\u4e8b\u5de5\u4f5c\u5ba4\uff08\u65b0UI\uff09"}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,o.jsxs)("div",{className:"md:col-span-1 bg-white rounded-lg shadow p-4 space-y-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium",children:"\u4e3b\u9898"}),(0,o.jsx)("input",{value:s,onChange:e=>r(e.target.value),className:"mt-1 w-full border rounded px-3 py-2",placeholder:"\u4f8b\u5982\uff1a\u96fe\u5c9a\u53e4\u5821\u7684\u7b2c\u516b\u58f0"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium",children:"Profile"}),(0,o.jsxs)("select",{value:n,onChange:e=>l(e.target.value),className:"mt-1 w-full border rounded px-3 py-2",children:[(0,o.jsx)("option",{value:"strict",children:"strict\uff08\u4e25\u683c\u8fbe\u6807\uff09"}),(0,o.jsx)("option",{value:"balanced",children:"balanced\uff08\u5e73\u8861\uff09"}),(0,o.jsx)("option",{value:"creative",children:"creative\uff08\u521b\u610f\uff09"})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium",children:"Seed\uff08\u53ef\u9009\uff09"}),(0,o.jsx)("input",{value:i,onChange:e=>d(e.target.value),className:"mt-1 w-full border rounded px-3 py-2"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium",children:"\u9605\u8bfb\u7ea7\u522b"}),(0,o.jsxs)("select",{value:R,onChange:e=>O(e.target.value),className:"mt-1 w-full border rounded px-3 py-2",children:[(0,o.jsx)("option",{value:"middle_grade",children:"middle_grade"}),(0,o.jsx)("option",{value:"early",children:"early"}),(0,o.jsx)("option",{value:"ya",children:"ya"})]})]}),(0,o.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium",children:"\u5e73\u5747\u53e5\u957f\u2264"}),(0,o.jsx)("input",{type:"number",value:P,onChange:e=>M(parseInt(e.target.value||"22",10)),className:"mt-1 w-full border rounded px-3 py-2"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium",children:"\u7ea2\u9cb1\u9c7c\u4e0a\u9650"}),(0,o.jsx)("input",{type:"number",step:"0.05",min:"0",max:"0.6",value:V,onChange:e=>B(parseFloat(e.target.value||"0.3")),className:"mt-1 w-full border rounded px-3 py-2"})]})]}),(0,o.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium",children:"\u5bf9\u767d\u6700\u5c11\u8f6e\u6b21"}),(0,o.jsx)("input",{type:"number",min:0,value:G,onChange:e=>W(Math.max(0,parseInt(e.target.value||"6",10))),className:"mt-1 w-full border rounded px-3 py-2"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium",children:"\u611f\u5b98\u63cf\u5199\u2265"}),(0,o.jsx)("input",{type:"number",min:0,value:q,onChange:e=>J(Math.max(0,parseInt(e.target.value||"2",10))),className:"mt-1 w-full border rounded px-3 py-2"})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium",children:"\u4e3b\u9898\u951a\u70b9\uff08\u9017\u53f7\u5206\u9694\uff09"}),(0,o.jsx)("input",{value:K,onChange:e=>Y(e.target.value),className:"mt-1 w-full border rounded px-3 py-2",placeholder:"\u4f8b\u5982\uff1a\u98ce,\u6f6e,\u949f\u58f0"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium mb-1",children:"\u53c2\u6570\u9884\u8bbe"}),(0,o.jsx)("div",{className:"flex flex-wrap gap-2",children:Te.map(e=>(0,o.jsx)("button",{type:"button",onClick:()=>{return t=e.values,M(t.avgSentenceLen),B(t.misdirectionCap),W(t.dialoguesMin),J(t.sensoryHooks),Y(t.themeAnchors),L(t.wordsPerScene),U(t.ch1MinClues),void F(t.minExposures);var t},className:"px-3 py-1 rounded border border-slate-300 text-sm hover:bg-slate-100",children:e.label},e.label))})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium",children:"\u7ae0\u8282\u5b57\u6570\u76ee\u6807"}),(0,o.jsx)("input",{type:"number",value:D,onChange:e=>L(parseInt(e.target.value||"1200",10)),className:"mt-1 w-full border rounded px-3 py-2"})]}),(0,o.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium",children:"Ch1\u6700\u5c11\u7ebf\u7d22\u6570"}),(0,o.jsx)("input",{type:"number",value:H,onChange:e=>U(parseInt(e.target.value||"2",10)),className:"mt-1 w-full border rounded px-3 py-2"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium",children:"\u7ebf\u7d22\u66dd\u5149\u6b21\u6570\u2265"}),(0,o.jsx)("input",{type:"number",value:z,onChange:e=>F(parseInt(e.target.value||"2",10)),className:"mt-1 w-full border rounded px-3 py-2"})]})]}),(0,o.jsx)("div",{}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium mb-1",children:"\u673a\u5173\u9884\u8bbe"}),(0,o.jsxs)("select",{value:Q||ke,onChange:e=>X(e.target.value),className:"mt-1 w-full border rounded px-3 py-2",children:[Ce.DETECTIVE_MECHANISM_PRESETS.map(e=>(0,o.jsx)("option",{value:e.id,children:e.label},e.id)),(0,o.jsx)("option",{value:ke,children:"\u81ea\u5b9a\u4e49\u5173\u952e\u8bcd"})]}),Q===ke?(0,o.jsx)("textarea",{className:"mt-2 w-full border rounded px-3 py-2 text-sm",rows:2,value:ee,onChange:e=>te(e.target.value),placeholder:"\u4f8b\u5982\uff1a\u955c\u9762,\u6298\u5c04,\u5149\u7ebf\uff08\u7528\u9017\u53f7\u6216\u7a7a\u683c\u5206\u9694\uff09"}):(0,o.jsxs)("p",{className:"text-xs text-slate-500 mt-1",children:["\u5173\u952e\u8bcd\uff1a",(null===oe||void 0===oe?void 0:oe.keywords.join("\u3001"))||"\uff08\u65e0\uff09"]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Reasoner\uff08\u84dd\u56fe\u9636\u6bb5\uff09"}),(0,o.jsxs)("label",{className:"inline-flex items-center mr-3 text-sm",children:[(0,o.jsx)("input",{type:"checkbox",className:"mr-1",checked:se,onChange:e=>ae(e.target.checked)})," \u4f7f\u7528 Reasoner"]}),(0,o.jsxs)("div",{className:"grid grid-cols-2 gap-2 mt-1",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-xs text-slate-600",children:"\u5019\u9009\u6570(1-3)"}),(0,o.jsx)("input",{type:"number",min:1,max:3,value:re,onChange:e=>ne(Math.max(1,Math.min(3,parseInt(e.target.value||"2",10)))),className:"mt-1 w-full border rounded px-3 py-2"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-xs text-slate-600",children:"\u529b\u5ea6"}),(0,o.jsxs)("select",{value:le,onChange:e=>ie(e.target.value),className:"mt-1 w-full border rounded px-3 py-2",children:[(0,o.jsx)("option",{value:"low",children:"low"}),(0,o.jsx)("option",{value:"medium",children:"medium"}),(0,o.jsx)("option",{value:"high",children:"high"})]})]})]})]}),(0,o.jsxs)("div",{className:"flex gap-2",children:[(0,o.jsx)("button",{onClick:async function(){S(null),N(!0);try{let t=c;if(!t){var e;const a=await async function(e,t,s,a){return _("/api/projects",{method:"POST",body:JSON.stringify({title:e,locale:t,protagonist:s,constraints:a})})}(s);t=null===a||void 0===a||null===(e=a.project)||void 0===e?void 0:e.project_id,u(t||null)}if(!t)throw new Error("\u9879\u76ee\u521b\u5efa\u5931\u8d25");const a=await async function(e,t){return _("/api/projects/".concat(e,"/plan"),{method:"POST",body:JSON.stringify(t||{})})}(t,{topic:s,profile:n,seed:i,options:ue.current});x((null===a||void 0===a?void 0:a.blueprintId)||null),h((null===a||void 0===a?void 0:a.outline)||null)}catch(t){S((null===t||void 0===t?void 0:t.message)||"\u751f\u6210\u84dd\u56fe\u5931\u8d25")}finally{N(!1)}},disabled:j,className:"bg-blue-600 text-white rounded px-4 py-2 disabled:opacity-50",children:"\u751f\u6210\u84dd\u56fe"}),m&&(0,o.jsx)("button",{onClick:async function(){if(m){S(null),N(!0);try{const e=await async function(e){return _("/api/blueprints/".concat(e))}(m);h((null===e||void 0===e?void 0:e.outline)||null)}catch(e){S((null===e||void 0===e?void 0:e.message)||"\u83b7\u53d6\u84dd\u56fe\u5931\u8d25")}finally{N(!1)}}},className:"bg-slate-200 rounded px-3 py-2",children:"\u5237\u65b0\u84dd\u56fe"})]}),w&&(0,o.jsx)("div",{className:"text-red-600 text-sm",children:w}),(0,o.jsxs)("div",{className:"text-xs text-slate-500",children:["\u9879\u76eeID\uff1a",c||"-"]}),(0,o.jsxs)("div",{className:"text-xs text-slate-500",children:["\u84dd\u56feID\uff1a",m||"-"]}),(0,o.jsx)("hr",{}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium",children:"scene_id"}),(0,o.jsx)("input",{value:v,onChange:e=>f(e.target.value),className:"mt-1 w-full border rounded px-3 py-2",placeholder:"S3"}),(0,o.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,o.jsx)("button",{onClick:async function(){if(c){S(null),N(!0);try{const e=await async function(e,t,s){return _("/api/projects/".concat(e,"/write?scene_id=").concat(encodeURIComponent(t)),{method:"POST",body:JSON.stringify(s||{})})}(c,v,{profile:n,seed:i,options:ue.current});y((null===e||void 0===e?void 0:e.chapter)||null)}catch(e){S((null===e||void 0===e?void 0:e.message)||"\u5199\u4f5c\u5931\u8d25")}finally{N(!1)}}},disabled:j||!c,className:"bg-emerald-600 text-white rounded px-3 py-2 disabled:opacity-50",children:"\u5199\u4f5c\u8be5\u7ae0"}),(0,o.jsx)("button",{onClick:async function(){if(c){S(null),N(!0);try{const e=await async function(e,t,s,a){const r=t?"?scene_id=".concat(encodeURIComponent(t)):"";return _("/api/projects/".concat(e,"/edit").concat(r),{method:"POST",body:JSON.stringify(s?(0,g.A)({chapter:s},a||{}):a||{})})}(c,b?void 0:v,b||void 0,{profile:n,seed:i,options:ue.current});y((null===e||void 0===e?void 0:e.chapter)||null)}catch(e){S((null===e||void 0===e?void 0:e.message)||"\u7f16\u8f91\u5931\u8d25")}finally{N(!1)}}},disabled:j||!c,className:"bg-violet-600 text-white rounded px-3 py-2 disabled:opacity-50",children:"\u7f16\u8f91\u964d\u7ea7"}),(0,o.jsx)("button",{onClick:async function(){if(c){S(null),N(!0);try{const e={ch1MinClues:H,minExposures:z},t=E?{draft:E,policy:e,updateOutlineExpected:!0}:{chapter:b,policy:e,updateOutlineExpected:!0},s=await async function(e,t){return _("/api/projects/".concat(e,"/autofix"),{method:"POST",body:JSON.stringify(t||{})})}(c,t);A((null===s||void 0===s?void 0:s.draft)||null),null!==s&&void 0!==s&&s.outline&&h(s.outline),T(null)}catch(e){S((null===e||void 0===e?void 0:e.message)||"\u81ea\u52a8\u4fee\u8ba2\u5931\u8d25")}finally{N(!1)}}},disabled:j||!c||!b&&!E,className:"bg-amber-700 text-white rounded px-3 py-2 disabled:opacity-50",children:"\u81ea\u52a8\u4fee\u8ba2\u5668"}),(0,o.jsx)("button",{onClick:async function(){if(c&&E){N(!0),S(null);try{const e=await async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"html+interactive";return _("/api/projects/".concat(e,"/compile?format=").concat(encodeURIComponent(s)),{method:"POST",body:JSON.stringify({draft:t})})}(c,E,"html+interactive");T(e||null),I("reader")}catch(e){S((null===e||void 0===e?void 0:e.message)||"\u5bfc\u51fa\u5931\u8d25")}finally{N(!1)}}},disabled:j||!c||!E,className:"bg-slate-700 text-white rounded px-3 py-2 disabled:opacity-50",children:"\u5bfc\u51fa HTML+\u4e92\u52a8\u5305"})]})]}),(0,o.jsx)("div",{})]}),(0,o.jsxs)("div",{className:"md:col-span-2 space-y-6",children:[(0,o.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,o.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,o.jsx)("h2",{className:"font-semibold",children:"\u84dd\u56fe Outline"})}),(0,o.jsx)("pre",{className:"text-xs whitespace-pre-wrap overflow-auto max-h-96",children:p?JSON.stringify(p,null,2):"\uff08\u5c1a\u672a\u751f\u6210\uff09"}),(0,o.jsx)("div",{className:"mt-2",children:(0,o.jsx)(Oe,{projectId:c,chapter:b,draft:E})})]}),(0,o.jsx)("div",{}),(0,o.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,o.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,o.jsx)("h2",{className:"font-semibold",children:"\u7ae0\u8282 Chapter\uff08\u5199\u4f5c/\u7f16\u8f91\u7ed3\u679c\uff09"})}),(0,o.jsx)("pre",{className:"text-xs whitespace-pre-wrap overflow-auto max-h-96",children:b?JSON.stringify(b,null,2):"\uff08\u5c1a\u672a\u5199\u4f5c/\u7f16\u8f91\uff09"}),(0,o.jsx)("div",{className:"mt-2",children:(0,o.jsx)(Oe,{projectId:c,chapter:b,draft:E})})]}),(0,o.jsx)("div",{}),(0,o.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,o.jsx)("h2",{className:"font-semibold",children:"\u6574\u7a3f"}),(0,o.jsxs)("div",{className:"inline-flex rounded-full border border-slate-200 overflow-hidden text-xs",children:[(0,o.jsx)("button",{type:"button",onClick:()=>I("reader"),className:"px-3 py-1 ".concat("reader"===k?"bg-slate-800 text-white":"text-slate-600"),children:"\u9605\u8bfb\u6a21\u5f0f"}),(0,o.jsx)("button",{type:"button",onClick:()=>I("debug"),className:"px-3 py-1 ".concat("debug"===k?"bg-slate-800 text-white":"text-slate-600"),children:"\u8c03\u8bd5\u6a21\u5f0f"})]})]}),"reader"===k?(0,o.jsx)("div",{className:"text-sm whitespace-pre-wrap leading-7 overflow-auto max-h-96 bg-slate-50 border border-slate-200 rounded p-3",children:ce||"\uff08\u6682\u65e0\u6574\u7a3f\uff0c\u8bf7\u5148\u5199\u4f5c\u6216\u5bfc\u51fa\uff09"}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"text-xs text-slate-500 mb-2",children:[(0,o.jsxs)("div",{children:["\u673a\u5173\u9884\u8bbe\uff1a",ue.current.mechanismLabel||"\u672a\u6307\u5b9a"]}),ue.current.deviceRealismHint&&(0,o.jsxs)("div",{children:["\u73b0\u5b9e\u8bf4\u660e\uff1a",ue.current.deviceRealismHint]})]}),(0,o.jsx)("pre",{className:"text-xs whitespace-pre-wrap overflow-auto max-h-96",children:E?JSON.stringify(E,null,2):"\uff08\u672a\u751f\u6210\u81ea\u52a8\u4fee\u8ba2\u7ed3\u679c\uff09"})]}),(0,o.jsx)("div",{className:"mt-2",children:(0,o.jsx)(Oe,{projectId:c,draft:E})}),C&&(0,o.jsxs)("div",{className:"mt-2 text-sm space-y-1",children:[(0,o.jsx)("div",{children:"\u5bfc\u51fa\u5b8c\u6210\uff1a"}),(0,o.jsx)("div",{children:(0,o.jsx)("a",{className:"text-blue-600 underline",href:C.urls.plain,target:"_blank",rel:"noreferrer",children:"\u4e0b\u8f7d\u7eaf\u6587\u672c"})}),(0,o.jsx)("div",{children:(0,o.jsx)("a",{className:"text-blue-600 underline",href:C.urls.html,target:"_blank",rel:"noreferrer",children:"\u9884\u89c8 HTML"})}),(0,o.jsx)("div",{children:(0,o.jsx)("a",{className:"text-blue-600 underline",href:C.urls.interactive,target:"_blank",rel:"noreferrer",children:"\u4e0b\u8f7d\u4e92\u52a8\u5305 JSON"})})]})]})]})]})]})})}function Re(e){let{label:t}=e;const s="pass"===t?"bg-green-100 text-green-600":"warn"===t?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-600";return(0,o.jsx)("span",{className:"inline-block px-2 py-1 rounded text-xs mr-2 ".concat(s),children:t})}function Oe(e){var t,s,r,n,l,i,d,c;let{projectId:u,chapter:m,draft:x}=e;const[p,h]=a.useState(null),[v,g]=a.useState(!1),[f,b]=a.useState(!1),[y,j]=a.useState(null);return(0,o.jsxs)("div",{children:[(0,o.jsx)("button",{disabled:!u||v,onClick:async function(){if(u){g(!0);try{const e=x?{draft:x}:m?{chapter:m}:{},t=await fetch("/api"+"/api/projects/".concat(u,"/validate"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json();if(!t.ok)throw new Error((null===s||void 0===s?void 0:s.error)||t.statusText);h((null===s||void 0===s?void 0:s.report)||null)}catch(e){alert((null===e||void 0===e?void 0:e.message)||"\u6821\u9a8c\u5931\u8d25")}finally{g(!1)}}},className:"bg-amber-600 text-white rounded px-3 py-2 disabled:opacity-50 mr-2",children:"\u5feb\u901f\u6821\u9a8c"}),(0,o.jsx)("button",{disabled:!u||f||!x&&!m,onClick:async function(){if(u){b(!0);try{const e=x?{draft:x}:m?{chapter:m}:null;if(!e)return alert("\u65e0\u53ef\u4fee\u8ba2\u5185\u5bb9"),void b(!1);e.policy={ch1MinClues:2,minExposures:2},e.updateOutlineExpected=!0;const t=await fetch("/api"+"/api/projects/".concat(u,"/autofix"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json();if(!t.ok)throw new Error((null===s||void 0===s?void 0:s.error)||t.statusText);const a=await fetch("/api"+"/api/projects/".concat(u,"/validate"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({draft:null===s||void 0===s?void 0:s.draft})}),r=await a.json();a.ok?j((null===r||void 0===r?void 0:r.report)||null):j(null)}catch(e){alert((null===e||void 0===e?void 0:e.message)||"\u81ea\u52a8\u4fee\u8ba2\u5931\u8d25")}finally{b(!1)}}},className:"bg-emerald-700 text-white rounded px-3 py-2 disabled:opacity-50",children:"\u4e00\u952e\u4fee\u590d"}),p&&(0,o.jsxs)("div",{className:"mt-2",children:[(0,o.jsxs)("div",{className:"text-sm mb-1",children:["\u7ed3\u679c\uff1apass=",(null===p||void 0===p||null===(t=p.summary)||void 0===t?void 0:t.pass)||0," warn=",(null===p||void 0===p||null===(s=p.summary)||void 0===s?void 0:s.warn)||0," fail=",(null===p||void 0===p||null===(r=p.summary)||void 0===r?void 0:r.fail)||0]}),x&&((null===p||void 0===p||null===(n=p.summary)||void 0===n?void 0:n.pass)||0)>=6&&0===((null===p||void 0===p||null===(l=p.summary)||void 0===l?void 0:l.fail)||0)&&(0,o.jsx)("div",{className:"text-green-700 bg-green-50 border border-green-200 inline-block px-2 py-1 rounded text-xs mb-2",children:"\u5df2\u8fbe\u6210\u53ef\u7528\u6807\u51c6 \u2705"}),(0,o.jsx)("div",{className:"flex flex-wrap gap-1",children:(p.results||[]).map(e=>(0,o.jsxs)("div",{className:"border rounded px-2 py-1 text-xs",children:[(0,o.jsx)("b",{children:e.ruleId})," ",(0,o.jsx)(Re,{label:e.status})]},e.ruleId))}),y&&(0,o.jsxs)("div",{className:"mt-3 border-t pt-2",children:[(0,o.jsxs)("div",{className:"text-sm",children:["\u4fee\u8ba2\u540e\u7ed3\u679c\uff1apass=",(null===y||void 0===y||null===(i=y.summary)||void 0===i?void 0:i.pass)||0," warn=",(null===y||void 0===y||null===(d=y.summary)||void 0===d?void 0:d.warn)||0," fail=",(null===y||void 0===y||null===(c=y.summary)||void 0===c?void 0:c.fail)||0]}),(0,o.jsx)("div",{className:"flex flex-wrap gap-1",children:(y.results||[]).map(e=>(0,o.jsxs)("div",{className:"border rounded px-2 py-1 text-xs",children:[(0,o.jsx)("b",{children:e.ruleId})," ",(0,o.jsx)(Re,{label:e.status})]},e.ruleId))})]})]})]})}const Pe={success:"bg-green-100 text-green-700",pending:"bg-amber-100 text-amber-700",error:"bg-red-100 text-red-700"},Me=e=>{var t,s,a;let{task:r}=e;const n=null!==(t=Pe[r.status])&&void 0!==t?t:"bg-gray-100 text-gray-600",l="number"===typeof r.durationMs?"".concat(Math.round(r.durationMs)," ms"):"\u2014",i=new Date(r.updatedAt).toLocaleString();return(0,o.jsx)("div",{className:"rounded-lg border border-gray-200 bg-white p-3 text-xs text-gray-600",children:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,o.jsx)("span",{className:"font-semibold text-gray-700",children:r.requestId||r.id}),(0,o.jsx)("span",{className:"px-2 py-0.5 rounded-full font-semibold capitalize ".concat(n),children:r.status})]}),(0,o.jsx)("p",{children:"\u8017\u65f6\uff1a".concat(l," \xb7 \u7f13\u5b58\uff1a").concat(r.cached?"\u662f":"\u5426")}),(null===(s=r.providerMetadata)||void 0===s?void 0:s.taskId)&&(0,o.jsx)("p",{children:"taskId\uff1a".concat(String(r.providerMetadata.taskId))}),(null===(a=r.providerMetadata)||void 0===a?void 0:a.sid)&&(0,o.jsx)("p",{children:"sid\uff1a".concat(String(r.providerMetadata.sid))}),(0,o.jsx)("p",{children:"\u66f4\u65b0\u65f6\u95f4\uff1a".concat(i)}),r.error&&(0,o.jsx)("p",{className:"text-red-600",children:"\u9519\u8bef\uff1a".concat(r.error)})]})})},De=()=>{var e,t,s,r,n;const{synthesizeStory:l,error:i}=Y(),[d,c]=(0,a.useState)(null),[u,m]=(0,a.useState)('## \u7b2c\u4e00\u7ae0 \u795e\u79d8\u7684\u9080\u8bf7\u51fd\n\n\u5c0f\u4fa6\u63a2\u5c0f\u660e\u6536\u5230\u4e86\u4e00\u5c01\u795e\u79d8\u7684\u9080\u8bf7\u51fd\uff0c\u9080\u8bf7\u4ed6\u53c2\u52a0\u5728\u6d77\u8fb9\u522b\u5885\u4e3e\u884c\u7684\u805a\u4f1a\u3002\u9080\u8bf7\u51fd\u4e0a\u5199\u7740\uff1a"\u4eb2\u7231\u7684\u5c0f\u660e\uff0c\u6211\u4eec\u8bda\u631a\u9080\u8bf7\u4f60\u53c2\u52a0\u672c\u5468\u672b\u5728\u6d77\u6ee8\u522b\u5885\u7684\u7279\u522b\u805a\u4f1a\u3002\u4f1a\u6709\u5f88\u591a\u6709\u8da3\u7684\u4eba\u548c\u4e8b\u7b49\u7740\u4f60\u3002"\n\n\u5c0f\u660e\u611f\u5230\u5341\u5206\u597d\u5947\uff0c\u51b3\u5b9a\u63a5\u53d7\u9080\u8bf7\u3002\u4ed6\u6536\u62fe\u597d\u884c\u674e\uff0c\u51c6\u5907\u524d\u5f80\u90a3\u5ea7\u4f20\u8bf4\u4e2d\u7684\u522b\u5885\u3002\n\n## \u7b2c\u4e8c\u7ae0 \u62b5\u8fbe\u522b\u5885\n\n\u5c0f\u660e\u4e58\u5750\u706b\u8f66\u6765\u5230\u6d77\u8fb9\u5c0f\u9547\uff0c\u53c8\u6b65\u884c\u4e86\u534a\u5c0f\u65f6\u624d\u627e\u5230\u90a3\u5ea7\u522b\u5885\u3002\u522b\u5885\u5750\u843d\u5728\u60ac\u5d16\u8fb9\u4e0a\uff0c\u5468\u56f4\u73af\u7ed5\u7740\u8302\u5bc6\u7684\u6811\u6797\uff0c\u663e\u5f97\u683c\u5916\u795e\u79d8\u3002\n\n\u5f53\u4ed6\u6309\u54cd\u95e8\u94c3\u65f6\uff0c\u4e00\u4f4d\u7ba1\u5bb6\u6a21\u6837\u7684\u8001\u4eba\u5f00\u95e8\u8fce\u63a5\u3002"\u6b22\u8fce\uff0c\u5c0f\u660e\u5148\u751f\u3002\u4e3b\u4eba\u5df2\u7ecf\u7b49\u5019\u591a\u65f6\u4e86\u3002"\u8001\u4eba\u8bf4\u9053\u3002\n\n## \u7b2c\u4e09\u7ae0 \u5947\u602a\u7684\u5ba2\u4eba\n\n\u8fdb\u5165\u522b\u5885\u5927\u5385\uff0c\u5c0f\u660e\u53d1\u73b0\u5df2\u7ecf\u6709\u51e0\u4f4d\u5ba2\u4eba\u5728\u7b49\u5f85\u3002\u6709\u4e00\u4f4d\u6234\u7740\u5355\u7247\u773c\u955c\u7684\u6559\u6388\uff0c\u4e00\u4f4d\u7a7f\u7740\u534e\u4e3d\u793c\u670d\u7684\u5973\u58eb\uff0c\u8fd8\u6709\u4e00\u4f4d\u770b\u8d77\u6765\u5f88\u5e74\u8f7b\u7684\u827a\u672f\u5bb6\u3002\n\n\u5927\u5bb6\u4e92\u76f8\u4ecb\u7ecd\u540e\uff0c\u4e3b\u4eba\u7ec8\u4e8e\u51fa\u73b0\u4e86\u3002\u4ed6\u662f\u4e00\u4f4d\u4e2d\u5e74\u7ec5\u58eb\uff0c\u8138\u4e0a\u603b\u662f\u5e26\u7740\u795e\u79d8\u7684\u5fae\u7b11\u3002"\u6b22\u8fce\u5404\u4f4d\u5149\u4e34\uff0c\u4eca\u665a\u5c06\u4f1a\u662f\u4e00\u4e2a\u96be\u5fd8\u7684\u591c\u665a\u3002"\n\n## \u7b2c\u56db\u7ae0 \u771f\u76f8\u5927\u767d\n\n\u968f\u7740\u8c03\u67e5\u7684\u6df1\u5165\uff0c\u5c0f\u660e\u53d1\u73b0\u8fd9\u4e00\u5207\u90fd\u662f\u4e3b\u4eba\u7cbe\u5fc3\u8bbe\u8ba1\u7684\u4e00\u573a\u6e38\u620f\u3002\u4ed6\u60f3\u6d4b\u8bd5\u8fd9\u4e9b\u806a\u660e\u4eba\u7684\u63a8\u7406\u80fd\u529b\u3002\u6700\u7ec8\uff0c\u5c0f\u660e\u51ed\u501f\u654f\u9510\u7684\u89c2\u5bdf\u529b\u548c\u7f1c\u5bc6\u7684\u903b\u8f91\uff0c\u6210\u529f\u89e3\u5f00\u4e86\u6240\u6709\u8c1c\u9898\u3002\n\n\u4e3b\u4eba\u5bf9\u5c0f\u660e\u7ad6\u8d77\u4e86\u5927\u62c7\u6307\uff1a"\u4f60\u771f\u662f\u4e00\u4f4d\u51fa\u8272\u7684\u4fa6\u63a2\uff01"'),[x,p]=(0,a.useState)(!1),[h,v]=(0,a.useState)(null),[g,f]=(0,a.useState)(null),[b,y]=(0,a.useState)([]),[j,N]=(0,a.useState)(null),[w,S]=(0,a.useState)(!1),E=(0,a.useCallback)(async()=>{S(!0);try{var e;const[t,s]=await Promise.all([B(),G({provider:"iflytek",limit:5})]);v(t),f(null),y(s.tasks),N(null!==(e=s.summary)&&void 0!==e?e:null)}catch(t){const e=(null===t||void 0===t?void 0:t.message)||"\u83b7\u53d6 TTS \u72b6\u6001\u5931\u8d25";f(e)}finally{S(!1)}},[]);(0,a.useEffect)(()=>{E()},[E]);return(0,o.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-blue-50 to-white p-8",children:(0,o.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,o.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-8 text-center",children:"\ud83c\udf99\ufe0f TTS \u957f\u6587\u672c\u6717\u8bfb\u6d4b\u8bd5"}),(0,o.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-8",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-3 mb-4",children:[(0,o.jsx)("h2",{className:"text-xl font-semibold text-gray-800 flex items-center gap-2",children:"\ud83d\udee1\ufe0f \u6717\u8bfb\u5f15\u64ce\u72b6\u6001"}),(0,o.jsx)("button",{onClick:E,disabled:w,className:"px-4 py-2 rounded-lg text-sm font-semibold transition ".concat(w?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700 hover:shadow-md"),children:w?"\u5237\u65b0\u4e2d\u2026":"\u5237\u65b0\u72b6\u6001"})]}),g&&(0,o.jsxs)("div",{className:"rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-red-600 text-sm",children:["\u274c ",g]}),h&&(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,o.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-semibold uppercase tracking-wide ".concat("ok"===h.status?"bg-green-100 text-green-700":"degraded"===h.status?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700"),children:"\u72b6\u6001\uff1a".concat("ok"===h.status?"\u6b63\u5e38":"degraded"===h.status?"\u964d\u7ea7":"\u51ed\u8bc1\u7f3a\u5931")}),(0,o.jsxs)("span",{className:"text-sm text-gray-600",children:["\u5f53\u524d provider\uff1a",(0,o.jsx)("strong",{children:h.provider})]}),(null===(e=h.capabilities)||void 0===e?void 0:e.defaultVoice)&&(0,o.jsxs)("span",{className:"text-sm text-gray-600",children:["\u9ed8\u8ba4\u97f3\u8272\uff1a",h.capabilities.defaultVoice]}),(0,o.jsxs)("span",{className:"text-xs text-gray-400",children:["\u66f4\u65b0\u65f6\u95f4\uff1a",new Date(h.timestamp).toLocaleString()]})]}),(0,o.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,o.jsxs)("div",{className:"rounded-xl bg-gray-50 border border-gray-100 p-4",children:[(0,o.jsx)("p",{className:"text-sm font-semibold text-gray-700 mb-2",children:"\u51ed\u8bc1\u914d\u7f6e"}),(0,o.jsxs)("ul",{className:"space-y-1 text-xs text-gray-600",children:[(0,o.jsx)("li",{children:"APP_ID\uff1a".concat(h.credentials.appId?"\u2705":"\u26a0\ufe0f \u672a\u914d\u7f6e")}),(0,o.jsx)("li",{children:"API_KEY\uff1a".concat(h.credentials.apiKey?"\u2705":"\u26a0\ufe0f \u672a\u914d\u7f6e")}),(0,o.jsx)("li",{children:"API_SECRET\uff1a".concat(h.credentials.apiSecret?"\u2705":"\u26a0\ufe0f \u672a\u914d\u7f6e")})]})]}),(0,o.jsxs)("div",{className:"rounded-xl bg-gray-50 border border-gray-100 p-4",children:[(0,o.jsx)("p",{className:"text-sm font-semibold text-gray-700 mb-2",children:"\u4efb\u52a1\u7edf\u8ba1\uff08\u8fd1 1 \u5c0f\u65f6\uff09"}),(0,o.jsxs)("div",{className:"flex gap-4 text-xs text-gray-600",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"font-semibold text-gray-700 text-sm",children:null!==(t=null===j||void 0===j?void 0:j.total)&&void 0!==t?t:0}),(0,o.jsx)("p",{children:"\u603b\u4efb\u52a1"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"font-semibold text-green-600 text-sm",children:null!==(s=null===j||void 0===j?void 0:j.success)&&void 0!==s?s:0}),(0,o.jsx)("p",{children:"\u6210\u529f"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"font-semibold text-amber-600 text-sm",children:null!==(r=null===j||void 0===j?void 0:j.pending)&&void 0!==r?r:0}),(0,o.jsx)("p",{children:"\u8fdb\u884c\u4e2d"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"font-semibold text-red-600 text-sm",children:null!==(n=null===j||void 0===j?void 0:j.error)&&void 0!==n?n:0}),(0,o.jsx)("p",{children:"\u5931\u8d25"})]})]}),(null===j||void 0===j?void 0:j.lastError)&&(0,o.jsxs)("p",{className:"mt-3 text-xs text-red-600",children:["\u6700\u8fd1\u5931\u8d25\uff08",new Date(j.lastError.updatedAt).toLocaleTimeString(),"\uff09\uff1a",j.lastError.error||"\u672a\u77e5\u9519\u8bef"]})]})]}),h.warnings&&h.warnings.length>0&&(0,o.jsx)("div",{className:"rounded-lg border border-amber-200 bg-amber-50 px-4 py-3 text-xs text-amber-700",children:h.warnings.map(e=>(0,o.jsx)("p",{children:"\u26a0\ufe0f ".concat(e)},e))}),(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"text-sm font-semibold text-gray-700 mb-2",children:"\u6700\u65b0\u4efb\u52a1"}),0===b.length?(0,o.jsx)("p",{className:"text-xs text-gray-500",children:"\u6682\u65e0\u4efb\u52a1\u6570\u636e\uff0c\u53ef\u5c1d\u8bd5\u751f\u6210\u4e00\u6b21\u6717\u8bfb\u3002"}):(0,o.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:b.map(e=>(0,o.jsx)(Me,{task:e},e.id))})]})]})]}),(0,o.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-8",children:[(0,o.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"\u6545\u4e8b\u6587\u672c"}),(0,o.jsx)("textarea",{value:u,onChange:e=>m(e.target.value),className:"w-full h-64 p-4 border border-gray-300 rounded-lg font-mono text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"\u5728\u8fd9\u91cc\u8f93\u5165\u6545\u4e8b\u6587\u672c..."}),(0,o.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,o.jsxs)("p",{className:"text-sm text-gray-600",children:["\u5b57\u6570\uff1a",u.length," / \u9884\u4f30\u65f6\u957f\uff1a",Math.ceil(u.length/5)," \u79d2 (\u2248"," ",Math.ceil(u.length/300)," \u5206\u949f)"]}),(0,o.jsx)("button",{onClick:async()=>{try{var e;p(!0);const t=await l({storyId:"test-story-"+Date.now(),fullText:u,voiceId:(null===h||void 0===h||null===(e=h.capabilities)||void 0===e?void 0:e.defaultVoice)||"iflytek_doudou",speed:1});c({storyId:t.storyId,totalDuration:t.totalDuration,segments:t.segments}),E()}catch(t){console.error("\u5408\u6210\u5931\u8d25:",t)}finally{p(!1)}},disabled:x||!u.trim(),className:"px-6 py-3 rounded-lg font-semibold text-white shadow-md transition-all ".concat(x||!u.trim()?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 hover:shadow-lg hover:scale-105"),children:x?(0,o.jsxs)("span",{className:"flex items-center gap-2",children:[(0,o.jsxs)("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,o.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,o.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"\u5408\u6210\u4e2d..."]}):"\ud83d\udd0a \u5f00\u59cb\u6717\u8bfb"})]})]}),i&&(0,o.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-8",children:(0,o.jsxs)("p",{className:"text-red-600",children:["\u274c ",i]})}),d&&(0,o.jsxs)("div",{className:"mb-8",children:[(0,o.jsx)(F,{storyId:d.storyId,segments:d.segments,totalDuration:d.totalDuration}),(0,o.jsxs)("details",{className:"mt-4 bg-white rounded-lg p-4 shadow",children:[(0,o.jsxs)("summary",{className:"cursor-pointer font-semibold text-gray-700",children:["\ud83d\udcca \u5206\u6bb5\u8be6\u60c5 (",d.segments.length," \u6bb5)"]}),(0,o.jsx)("div",{className:"mt-4 space-y-2 max-h-96 overflow-y-auto",children:d.segments.map(e=>(0,o.jsxs)("div",{className:"p-3 bg-gray-50 rounded border border-gray-200",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,o.jsxs)("span",{className:"font-semibold text-sm",children:["\u7b2c ",e.segmentIndex+1," \u6bb5",e.chapterTitle&&" \xb7 ".concat(e.chapterTitle)]}),(0,o.jsxs)("span",{className:"text-xs text-gray-500",children:[e.duration," \u79d2",e.cached&&" \xb7 \u5df2\u7f13\u5b58"]})]}),e.error&&(0,o.jsxs)("p",{className:"text-xs text-red-600 mt-1",children:["\u274c ",e.error]}),(0,o.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:["\u4f4d\u7f6e: ",e.startOffset," - ",e.endOffset]})]},e.segmentIndex))})]})]}),(0,o.jsxs)("div",{className:"bg-blue-50 rounded-lg p-6",children:[(0,o.jsx)("h3",{className:"font-semibold text-blue-900 mb-3",children:"\ud83d\udcd6 \u4f7f\u7528\u8bf4\u660e"}),(0,o.jsxs)("ul",{className:"space-y-2 text-sm text-blue-800",children:[(0,o.jsxs)("li",{children:["\u2705 ",(0,o.jsx)("strong",{children:'\u70b9\u51fb"\u5f00\u59cb\u6717\u8bfb"'}),"\uff1a\u7cfb\u7edf\u4f1a\u81ea\u52a8\u5206\u6bb5\u5408\u6210\uff08\u6bcf\u6bb5 \u22641000 \u5b57\uff09"]}),(0,o.jsxs)("li",{children:["\u2705 ",(0,o.jsx)("strong",{children:"\u62d6\u52a8\u8fdb\u5ea6\u6761"}),"\uff1a\u7acb\u5373\u8df3\u8f6c\u5230\u76ee\u6807\u4f4d\u7f6e\uff08\u81ea\u52a8\u5207\u6362\u5206\u6bb5\uff09"]}),(0,o.jsxs)("li",{children:["\u2705 ",(0,o.jsx)("strong",{children:"\u524d\u8fdb/\u540e\u9000 15 \u79d2"}),"\uff1a\u5feb\u901f\u8df3\u8f6c"]}),(0,o.jsxs)("li",{children:["\u2705 ",(0,o.jsx)("strong",{children:"\u7ae0\u8282\u6807\u8bb0"}),"\uff1a\u4f7f\u7528 ",(0,o.jsx)("code",{children:"## \u7b2cX\u7ae0"})," ","\u683c\u5f0f\u4f1a\u81ea\u52a8\u8bc6\u522b\u7ae0\u8282"]}),(0,o.jsxs)("li",{children:["\u2705 ",(0,o.jsx)("strong",{children:"\u7f13\u5b58\u673a\u5236"}),"\uff1a\u76f8\u540c\u6587\u672c\u4f1a\u590d\u7528\u7f13\u5b58\uff0c\u52a0\u5feb\u54cd\u5e94\u901f\u5ea6"]})]})]})]})})},Le={pending:{label:"\u6392\u961f\u4e2d",variant:"neutral"},running:{label:"\u751f\u6210\u4e2d",variant:"accent"},completed:{label:"\u5df2\u5b8c\u6210",variant:"success"},failed:{label:"\u5df2\u5931\u8d25",variant:"warning"}};function He(){const e=(0,l.Zp)(),[t,s]=(0,a.useState)([]),[r,n]=(0,a.useState)(null),[i,d]=(0,a.useState)(!1),[u,m]=(0,a.useState)(!1),v=(0,a.useMemo)(()=>!!r&&r.page<r.pages,[r]);(0,a.useEffect)(()=>{g(1,!1)},[]);const g=async(e,t)=>{t?m(!0):d(!0);try{const a=await async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new URLSearchParams;return e.page&&t.set("page",String(e.page)),e.limit&&t.set("limit",String(e.limit)),e.status&&t.set("status",e.status),_("/api/story-workflows".concat(t.toString()?"?".concat(t):""))}({page:e,limit:8,status:"completed"});s(e=>t?[...e,...a.items]:a.items),n(a.pagination)}catch(a){console.error("\u52a0\u8f7d\u5386\u53f2\u6545\u4e8b\u5931\u8d25",a);const e=(null===a||void 0===a?void 0:a.message)||"\u52a0\u8f7d\u5386\u53f2\u6545\u4e8b\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5";h.oR.error(e)}finally{d(!1),m(!1)}},f=e=>{try{const t=new Date(e);return new Intl.DateTimeFormat("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(t)}catch(t){return e}};return(0,o.jsx)(x,{maxWidth:"3xl",topBar:(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2 text-points-primary",children:[(0,o.jsx)(M.A,{className:"h-5 w-5"}),(0,o.jsx)("span",{className:"text-sm font-semibold",children:"\u5386\u53f2\u6545\u4e8b\u8bb0\u5f55"})]}),(0,o.jsx)("div",{className:"flex items-center gap-2",children:(0,o.jsxs)(C,{variant:"ghost",size:"small",onClick:()=>e("/"),children:[(0,o.jsx)(ee.A,{className:"mr-1 h-4 w-4"}),"\u8fd4\u56de\u9996\u9875"]})})]}),children:(0,o.jsx)(p,{title:"\u521b\u4f5c\u5386\u53f2",layout:"card",className:"space-y-6",actions:(0,o.jsx)(C,{variant:"ghost",size:"small",icon:(0,o.jsx)(re.A,{className:"h-4 w-4"}),onClick:()=>{g(1,!1)},disabled:i,children:"\u5237\u65b0"}),children:i&&!t.length?(0,o.jsxs)("div",{className:"flex flex-col items-center justify-center py-16 text-points-text-muted",children:[(0,o.jsx)(T,{size:"medium"}),(0,o.jsx)("p",{className:"mt-4 text-sm",children:"\u6b63\u5728\u52a0\u8f7d\u5386\u53f2\u6545\u4e8b\uff0c\u8bf7\u7a0d\u5019\u2026"})]}):0===t.length?(0,o.jsxs)("div",{className:"rounded-2xl bg-points-bg p-10 text-center text-points-text-muted",children:[(0,o.jsx)("p",{className:"text-base font-medium",children:"\u8fd8\u6ca1\u6709\u5386\u53f2\u6545\u4e8b"}),(0,o.jsx)("p",{className:"mt-2 text-sm",children:"\u751f\u6210\u7684\u6545\u4e8b\u4f1a\u81ea\u52a8\u4fdd\u5b58\u5728\u8fd9\u91cc\uff0c\u65b9\u4fbf\u968f\u65f6\u56de\u987e\u3002"}),(0,o.jsx)(C,{className:"mt-6",onClick:()=>e("/"),children:"\u53bb\u751f\u6210\u7b2c\u4e00\u4e2a\u6545\u4e8b"})]}):(0,o.jsxs)("div",{className:"space-y-4",children:[t.map(t=>{var s;const a=null!==(s=Le[t.status])&&void 0!==s?s:Le.pending;return(0,o.jsxs)("div",{className:"flex flex-col justify-between gap-4 rounded-2xl border border-points-border bg-white p-4 transition hover:border-points-primary/60 hover:shadow-soft md:flex-row md:items-center",children:[(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsxs)("div",{className:"flex items-center gap-3",children:[(0,o.jsx)("h3",{className:"text-lg font-semibold text-points-text",children:t.topic}),(0,o.jsx)(c,{variant:a.variant,children:a.label})]}),(0,o.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-4 text-sm text-points-text-muted",children:[(0,o.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,o.jsx)(O.A,{className:"h-4 w-4"}),"\u521b\u5efa\uff1a",f(t.createdAt)]}),(0,o.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,o.jsx)(O.A,{className:"h-4 w-4"}),"\u66f4\u65b0\uff1a",f(t.updatedAt)]}),t.latestRevisionType&&(0,o.jsxs)("span",{className:"inline-flex items-center gap-1",children:["\u6700\u8fd1\u4fee\u8ba2\uff1a",t.latestRevisionType]})]})]}),(0,o.jsx)("div",{className:"flex items-center gap-2",children:(0,o.jsx)(C,{variant:"ghost",onClick:()=>{return s=t._id,void e("/story/".concat(s),{state:{openTimeline:!0}});var s},children:"\u67e5\u770b\u8be6\u60c5"})})]},t._id)}),v&&(0,o.jsx)("div",{className:"flex justify-center pt-4",children:(0,o.jsx)(C,{onClick:()=>{var e;g((null!==(e=null===r||void 0===r?void 0:r.page)&&void 0!==e?e:1)+1,!0)},disabled:u,variant:"secondary",children:u?(0,o.jsxs)("span",{className:"flex items-center gap-2",children:[(0,o.jsx)(T,{size:"small"}),"\u6b63\u5728\u52a0\u8f7d\u2026"]}):"\u52a0\u8f7d\u66f4\u591a"})})]})})})}const Ue=function(){return(0,o.jsx)(w,{children:(0,o.jsx)(n.Kd,{children:(0,o.jsxs)("div",{className:"App min-h-screen text-points-text",children:[(0,o.jsx)(v,{}),(0,o.jsxs)(l.BV,{children:[(0,o.jsx)(l.qh,{path:"/",element:(0,o.jsx)(z,{})}),(0,o.jsx)(l.qh,{path:"/story/:workflowId",element:(0,o.jsx)(Ae,{})}),(0,o.jsx)(l.qh,{path:"/builder",element:(0,o.jsx)(Ie,{})}),(0,o.jsx)(l.qh,{path:"/tts-test",element:(0,o.jsx)(De,{})}),(0,o.jsx)(l.qh,{path:"/history",element:(0,o.jsx)(He,{})})]})]})})})};const ze="".concat("","/service-worker.js"),Fe=e=>{window.confirm("\u6709\u65b0\u7248\u672c\u7684\u6545\u4e8b\u4f53\u9a8c\u53ef\u7528\uff0c\u662f\u5426\u7acb\u5373\u66f4\u65b0\uff1f")&&(e=>{e.waiting&&e.waiting.postMessage({type:"SKIP_WAITING"})})(e)};r.createRoot(document.getElementById("root")).render((0,o.jsx)(a.StrictMode,{children:(0,o.jsx)(Ue,{})})),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register(ze).then(e=>{e.waiting&&Fe(e),e.addEventListener("updatefound",()=>{const t=e.installing;t&&t.addEventListener("statechange",()=>{"installed"===t.state&&navigator.serviceWorker.controller&&Fe(e)})});let t=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{t||(t=!0,window.location.reload())})}).catch(e=>{console.error("Service Worker \u6ce8\u518c\u5931\u8d25",e)})})},297:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SUCCESS_MESSAGES=t.ERROR_MESSAGES=t.HTTP_STATUS=t.API_ENDPOINTS=t.MIN_CHOICES_COUNT=t.MAX_CHOICES_COUNT=t.DEFAULT_CHOICES_COUNT=t.STORY_DIFFICULTY=t.STORY_THEMES=t.DEFAULT_AGE_GROUPS=void 0,t.DEFAULT_AGE_GROUPS={TODDLER:"3-5",CHILD:"6-8",TWEEN:"9-12",TEEN:"13-15"},t.STORY_THEMES={ADVENTURE:"adventure",FRIENDSHIP:"friendship",FAMILY:"family",NATURE:"nature",FANTASY:"fantasy",SCIENCE:"science",ANIMALS:"animals",MAGIC:"magic"},t.STORY_DIFFICULTY={EASY:"easy",MEDIUM:"medium",HARD:"hard"},t.DEFAULT_CHOICES_COUNT=3,t.MAX_CHOICES_COUNT=6,t.MIN_CHOICES_COUNT=2,t.API_ENDPOINTS={GENERATE_STORY:"/api/generate-story",SAVE_STORY:"/api/save-story",GET_STORIES:"/api/get-stories",GET_STORY:"/api/get-story",HEALTH:"/api/health",HEALTHZ:"/healthz",TTS:"/api/tts",TTS_VOICES:"/api/tts/voices"},t.HTTP_STATUS={OK:200,CREATED:201,BAD_REQUEST:400,UNAUTHORIZED:401,FORBIDDEN:403,NOT_FOUND:404,INTERNAL_SERVER_ERROR:500},t.ERROR_MESSAGES={TOPIC_REQUIRED:"story_topic_required",STORY_GENERATION_FAILED:"story_generation_failed",STORY_SAVE_FAILED:"story_save_failed",STORY_NOT_FOUND:"story_not_found",INVALID_REQUEST:"invalid_request",SERVER_ERROR:"server_error"},t.SUCCESS_MESSAGES={STORY_GENERATED:"story_generated_successfully",STORY_SAVED:"story_saved_successfully"}},613:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},649:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},682:function(e,t,s){var a=this&&this.__createBinding||(Object.create?function(e,t,s,a){void 0===a&&(a=s);var r=Object.getOwnPropertyDescriptor(t,s);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,a,r)}:function(e,t,s,a){void 0===a&&(a=s),e[a]=t[s]}),r=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||a(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),r(s(613),t),r(s(751),t),r(s(297),t),r(s(145),t),r(s(649),t)},751:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})}},e=>{e.O(0,[411,968,96],()=>{return t=259,e(e.s=t);var t});e.O()}]);