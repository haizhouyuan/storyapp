#!/bin/bash

# æ¸…æ´çš„é˜¿é‡Œäº‘æœåŠ¡å™¨SSHå¯†é’¥è®¾ç½®æŒ‡å—
# ç¡®ä¿åœ¨æ­£ç¡®çš„æœåŠ¡å™¨çŽ¯å¢ƒä¸­æ‰§è¡Œ

echo "ðŸ”§ é˜¿é‡Œäº‘æœåŠ¡å™¨SSHå¯†é’¥è®¾ç½®æŒ‡å—"
echo "==============================="
echo ""
echo "âš ï¸  é‡è¦æé†’ï¼š"
echo "è¯·ç¡®ä¿ä½ åœ¨æ­£ç¡®çš„é˜¿é‡Œäº‘æœåŠ¡å™¨ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤"
echo "æœåŠ¡å™¨ä¸»æœºååº”è¯¥æ˜¯ï¼šiZf8z3uu2ea9wt48g6j5yoZ"
echo "æœåŠ¡å™¨IPåº”è¯¥åŒ…å«ï¼š47.120.74.212"
echo ""

echo "ðŸ“‹ æ­¥éª¤1ï¼šéªŒè¯æœåŠ¡å™¨èº«ä»½"
echo "------------------------"
echo "# æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ç¡®è®¤ä½ åœ¨æ­£ç¡®çš„æœåŠ¡å™¨ä¸Šï¼š"
echo "echo '=== æœåŠ¡å™¨èº«ä»½éªŒè¯ ==='"
echo "echo 'ä¸»æœºå:' && hostname"
echo "echo 'IPåœ°å€:' && ip addr show | grep 'inet ' | grep -v '127.0.0.1'"
echo "echo 'å½“å‰ç”¨æˆ·:' && whoami"
echo "echo 'å½“å‰è·¯å¾„:' && pwd"
echo ""
echo "æœŸæœ›ç»“æžœï¼š"
echo "- ä¸»æœºå: iZf8z3uu2ea9wt48g6j5yoZ"
echo "- IPåœ°å€: åº”åŒ…å« 47.120.74.212"
echo "- ç”¨æˆ·: root"
echo "- è·¯å¾„: /root"
echo ""

echo "ðŸ“‹ æ­¥éª¤2ï¼šè®¾ç½®SSHå¯†é’¥ï¼ˆä»…åœ¨éªŒè¯é€šè¿‡åŽæ‰§è¡Œï¼‰"
echo "-------------------------------------------"
echo ""
echo "# å¦‚æžœæ­¥éª¤1éªŒè¯é€šè¿‡ï¼Œå†æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š"
echo ""
echo "# å¤‡ä»½çŽ°æœ‰é…ç½®"
echo "cp ~/.ssh/authorized_keys ~/.ssh/authorized_keys.backup.$(date +%Y%m%d_%H%M%S) 2>/dev/null || true"
echo ""
echo "# åˆ›å»ºSSHç›®å½•"
echo "mkdir -p ~/.ssh"
echo "chmod 700 ~/.ssh"
echo ""
echo "# æ¸…ç†å¹¶è®¾ç½®authorized_keys"
echo "cat > ~/.ssh/authorized_keys << 'SSHKEY_EOF'"
echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCTnNkbs+K/3SoOix5KCBiNL9hUGLkFOkRBeMVtangyDVvsu8FTfallIPBbz6J42yTfXEfv38/H/9XqMvPI/Z3NVYfpp+t+KusxjyzguP6cTovLpdslwRcsl/Ehte3YlJlZJs4LGCSPkcfh+A/bkAVyK+E1NE9QPIvR488co3thPsFaONUtOLGF0yrqe1L5XJlax2XajDbIe+Z9oQsZ3sJsmU48j7Ji0T9ba70pk88gqYfrU+vztOuqg8/tdLxElfWOwJ44LUp2iYr3+YblKNnpYFDUNfxHjEET2FlYv1yjjzPSVfnmbVUi3Vi1jbQrKk2PoRIG/nzDnulMI3SfIkzrksPjsL2ZNdVoem6hKs/aWAQSuZN8ik+y8SiDsiBbFXhJenfCTHS0s5bNssLVIJnTBE0BWfeRKm3dWpbbBr7EOMRdmlfeKHGQCVp5fl4Q9aWGGPLBGb2T3X0eHNlEGZ4mY05K/km1d3zIW3pycyoqgB5Njo+BlA5gyEp96AZ3f/4TZZPnExeNTadGmxBJEqlqMNJYUquH/3UHIy+oNtwsiYnXgJEsTugfpXFACey39yUf0cbsbS0ys9sydthGqAWyzEJmlIOBOmsYkA5Fxo4kxKS8pZGNrIcmfqxM9jqx3X4EDGMkJy5qskFqDngcrUX4OvH/qH9oJqnPFoV4P2paCw== storyapp-20250922"
echo "SSHKEY_EOF"
echo ""
echo "# è®¾ç½®æƒé™"
echo "chmod 600 ~/.ssh/authorized_keys"
echo ""
echo "# éªŒè¯è®¾ç½®"
echo "echo '=== éªŒè¯SSHè®¾ç½® ==='"
echo "echo 'SSHç›®å½•æƒé™:'"
echo "ls -la ~/.ssh/"
echo "echo ''"
echo "echo 'authorized_keyså†…å®¹æ£€æŸ¥:'"
echo "wc -l ~/.ssh/authorized_keys"
echo "head -c 50 ~/.ssh/authorized_keys && echo '...'"
echo ""

echo "ðŸ“‹ æ­¥éª¤3ï¼šæœ€ç»ˆéªŒè¯"
echo "-----------------"
echo "echo '=== æœ€ç»ˆéªŒè¯ ==='"
echo "echo 'æœåŠ¡å™¨ä¿¡æ¯:'"
echo "hostname && hostname -I"
echo "echo 'SSHé…ç½®å®Œæˆï¼Œå¯ä»¥é€€å‡ºæœåŠ¡å™¨æµ‹è¯•è¿žæŽ¥'"
echo ""

echo "ðŸ§ª æœ¬åœ°æµ‹è¯•å‘½ä»¤"
echo "==============="
echo "# åœ¨æœ¬åœ°æœºå™¨ä¸Šæ‰§è¡Œï¼š"
echo "ssh -o BatchMode=yes -o ConnectTimeout=10 storyapp-server 'echo \"SSHå…å¯†ç™»å½•æˆåŠŸ - \$(date)\"'"
