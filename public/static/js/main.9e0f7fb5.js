"use strict";(self.webpackChunkstory_app_frontend=self.webpackChunkstory_app_frontend||[]).push([[792],{658:(e,t,s)=>{var n=s(878),a=s(664),l=s(330),i=s(229),r=s(782);var c=s(45);function o(){return(0,r.jsx)(c.l$,{position:"top-center",toastOptions:{duration:3500,style:{background:"rgba(255, 255, 255, 0.92)",color:"rgb(var(--points-text))",borderRadius:"var(--radius-lg)",border:"1px solid rgba(var(--points-border), 0.6)",boxShadow:"var(--shadow-soft)",padding:"14px 18px",fontWeight:600,fontFamily:"Quicksand, Nunito, sans-serif"},success:{iconTheme:{primary:"rgb(var(--points-success))",secondary:"#ffffff"}},error:{iconTheme:{primary:"rgb(var(--points-danger))",secondary:"#ffffff"}}}})}var d=s(957);const u={STORY_SESSION:"storyapp_current_session",STORY_HISTORY:"storyapp_story_history",USER_PREFERENCES:"storyapp_user_preferences"},p={soundEnabled:!0,animationEnabled:!0,fontSize:"medium",theme:"default",speechSpeed:1,speechPitch:1,autoPlay:!1,mute:!1,showTranscript:!0};function m(e){try{const t=x(),s=(0,d.A)((0,d.A)({},t),e);localStorage.setItem(u.USER_PREFERENCES,JSON.stringify(s))}catch(t){console.error("\u4fdd\u5b58\u7528\u6237\u504f\u597d\u5931\u8d25:",t)}}function x(){try{const e=localStorage.getItem(u.USER_PREFERENCES);return e?(0,d.A)((0,d.A)({},p),JSON.parse(e)):(0,d.A)({},p)}catch(e){return console.error("\u83b7\u53d6\u7528\u6237\u504f\u597d\u5931\u8d25:",e),(0,d.A)({},p)}}const h=(0,n.createContext)(void 0),v=e=>{let{children:t}=e;const[s,a]=(0,n.useState)(()=>x()),l=(0,n.useCallback)(e=>{a(t=>{const s=(0,d.A)((0,d.A)({},t),e);return m(s),s})},[]),i=(0,n.useCallback)(()=>{m(p),a((0,d.A)({},p))},[]),c=(0,n.useMemo)(()=>({preferences:s,updatePreferences:l,resetPreferences:i}),[s,i,l]);return(0,r.jsx)(h.Provider,{value:c,children:t})},f="/api".replace(/\/$/,"");async function j(e,t){var s;const n=await fetch("".concat(f).concat(e),(0,d.A)({headers:{"Content-Type":"application/json"},credentials:"include"},t));if(!n.ok){const e=await n.json().catch(()=>({})),t=new Error((null===e||void 0===e?void 0:e.message)||n.statusText);throw t.status=n.status,t.code=null===e||void 0===e?void 0:e.error,t}const a=await n.json().catch(()=>({}));return null!==(s=null===a||void 0===a?void 0:a.data)&&void 0!==s?s:a}function b(){const[e,t]=n.useState("\u96fe\u5c9a\u53e4\u5821\u7684\u7b2c\u516b\u58f0"),[s,a]=n.useState("balanced"),[l,i]=n.useState("seed-demo"),[c,o]=n.useState(null),[u,p]=n.useState(null),[m,x]=n.useState(null),[h,v]=n.useState("S3"),[f,b]=n.useState(null),[y,N]=n.useState(!1),[w,S]=n.useState(null),[k,C]=n.useState(null),[E,O]=n.useState(null),[_,I]=n.useState("middle_grade"),[T,P]=n.useState(22),[R,A]=n.useState(2),[J,L]=n.useState(2),[M,U]=n.useState(.3),[W,F]=n.useState(["\u98ce\u9053","\u6f6e\u6c50","\u5171\u632f","\u6ed1\u8f6e"]),D=n.useRef({readingLevel:"middle_grade",targets:{avgSentenceLen:22},cluePolicy:{ch1MinClues:2,minExposures:2},misdirectionCap:.3,deviceVariant:["\u98ce\u9053","\u6f6e\u6c50","\u5171\u632f","\u6ed1\u8f6e"]});function H(){D.current={readingLevel:_,targets:{avgSentenceLen:T},cluePolicy:{ch1MinClues:R,minExposures:J},misdirectionCap:M,deviceVariant:W}}return(0,r.jsx)("div",{className:"min-h-screen bg-slate-50 text-slate-800",children:(0,r.jsxs)("div",{className:"max-w-6xl mx-auto py-10 px-4",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"\u4fa6\u63a2\u6545\u4e8b\u5de5\u4f5c\u5ba4\uff08\u65b0UI\uff09"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{className:"md:col-span-1 bg-white rounded-lg shadow p-4 space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium",children:"\u4e3b\u9898"}),(0,r.jsx)("input",{value:e,onChange:e=>t(e.target.value),className:"mt-1 w-full border rounded px-3 py-2",placeholder:"\u4f8b\u5982\uff1a\u96fe\u5c9a\u53e4\u5821\u7684\u7b2c\u516b\u58f0"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium",children:"Profile"}),(0,r.jsxs)("select",{value:s,onChange:e=>a(e.target.value),className:"mt-1 w-full border rounded px-3 py-2",children:[(0,r.jsx)("option",{value:"strict",children:"strict\uff08\u4e25\u683c\u8fbe\u6807\uff09"}),(0,r.jsx)("option",{value:"balanced",children:"balanced\uff08\u5e73\u8861\uff09"}),(0,r.jsx)("option",{value:"creative",children:"creative\uff08\u521b\u610f\uff09"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium",children:"Seed\uff08\u53ef\u9009\uff09"}),(0,r.jsx)("input",{value:l,onChange:e=>i(e.target.value),className:"mt-1 w-full border rounded px-3 py-2"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium",children:"\u9605\u8bfb\u7ea7\u522b"}),(0,r.jsxs)("select",{value:_,onChange:e=>{I(e.target.value),H()},className:"mt-1 w-full border rounded px-3 py-2",children:[(0,r.jsx)("option",{value:"middle_grade",children:"middle_grade"}),(0,r.jsx)("option",{value:"early",children:"early"}),(0,r.jsx)("option",{value:"ya",children:"ya"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium",children:"\u5e73\u5747\u53e5\u957f\u2264"}),(0,r.jsx)("input",{type:"number",value:T,onChange:e=>{P(parseInt(e.target.value||"22",10)),H()},className:"mt-1 w-full border rounded px-3 py-2"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium",children:"\u7ea2\u9cb1\u9c7c\u4e0a\u9650"}),(0,r.jsx)("input",{type:"number",step:"0.05",min:"0",max:"0.6",value:M,onChange:e=>{U(parseFloat(e.target.value||"0.3")),H()},className:"mt-1 w-full border rounded px-3 py-2"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium",children:"Ch1\u6700\u5c11\u7ebf\u7d22\u6570"}),(0,r.jsx)("input",{type:"number",value:R,onChange:e=>{A(parseInt(e.target.value||"2",10)),H()},className:"mt-1 w-full border rounded px-3 py-2"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium",children:"\u7ebf\u7d22\u66dd\u5149\u6b21\u6570\u2265"}),(0,r.jsx)("input",{type:"number",value:J,onChange:e=>{L(parseInt(e.target.value||"2",10)),H()},className:"mt-1 w-full border rounded px-3 py-2"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"\u673a\u5236\u7ec4\u5408\uff08\u53ef\u591a\u9009\uff09"}),["\u98ce\u9053","\u6f6e\u6c50","\u5171\u632f","\u6ed1\u8f6e"].map(e=>(0,r.jsxs)("label",{className:"inline-flex items-center mr-3 text-sm",children:[(0,r.jsx)("input",{type:"checkbox",className:"mr-1",checked:W.includes(e),onChange:()=>{F(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e]),setTimeout(H,0)}})," ",e]},e))]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:async function(){S(null),N(!0);try{let n=c;if(!n){var t;const s=await async function(e,t,s,n){return j("/api/projects",{method:"POST",body:JSON.stringify({title:e,locale:t,protagonist:s,constraints:n})})}(e);n=null===s||void 0===s||null===(t=s.project)||void 0===t?void 0:t.project_id,o(n||null)}if(!n)throw new Error("\u9879\u76ee\u521b\u5efa\u5931\u8d25");const a=await async function(e,t){return j("/api/projects/".concat(e,"/plan"),{method:"POST",body:JSON.stringify(t||{})})}(n,{topic:e,profile:s,seed:l,options:D.current});p((null===a||void 0===a?void 0:a.blueprintId)||null),x((null===a||void 0===a?void 0:a.outline)||null)}catch(n){S((null===n||void 0===n?void 0:n.message)||"\u751f\u6210\u84dd\u56fe\u5931\u8d25")}finally{N(!1)}},disabled:y,className:"bg-blue-600 text-white rounded px-4 py-2 disabled:opacity-50",children:"\u751f\u6210\u84dd\u56fe"}),u&&(0,r.jsx)("button",{onClick:async function(){if(u){S(null),N(!0);try{const e=await async function(e){return j("/api/blueprints/".concat(e))}(u);x((null===e||void 0===e?void 0:e.outline)||null)}catch(e){S((null===e||void 0===e?void 0:e.message)||"\u83b7\u53d6\u84dd\u56fe\u5931\u8d25")}finally{N(!1)}}},className:"bg-slate-200 rounded px-3 py-2",children:"\u5237\u65b0\u84dd\u56fe"})]}),w&&(0,r.jsx)("div",{className:"text-red-600 text-sm",children:w}),(0,r.jsxs)("div",{className:"text-xs text-slate-500",children:["\u9879\u76eeID\uff1a",c||"-"]}),(0,r.jsxs)("div",{className:"text-xs text-slate-500",children:["\u84dd\u56feID\uff1a",u||"-"]}),(0,r.jsx)("hr",{}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium",children:"scene_id"}),(0,r.jsx)("input",{value:h,onChange:e=>v(e.target.value),className:"mt-1 w-full border rounded px-3 py-2",placeholder:"S3"}),(0,r.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,r.jsx)("button",{onClick:async function(){if(c){S(null),N(!0);try{const e=await async function(e,t,s){return j("/api/projects/".concat(e,"/write?scene_id=").concat(encodeURIComponent(t)),{method:"POST",body:JSON.stringify(s||{})})}(c,h,{profile:s,seed:l,options:D.current});b((null===e||void 0===e?void 0:e.chapter)||null)}catch(e){S((null===e||void 0===e?void 0:e.message)||"\u5199\u4f5c\u5931\u8d25")}finally{N(!1)}}},disabled:y||!c,className:"bg-emerald-600 text-white rounded px-3 py-2 disabled:opacity-50",children:"\u5199\u4f5c\u8be5\u7ae0"}),(0,r.jsx)("button",{onClick:async function(){if(c){S(null),N(!0);try{const e=await async function(e,t,s,n){const a=t?"?scene_id=".concat(encodeURIComponent(t)):"";return j("/api/projects/".concat(e,"/edit").concat(a),{method:"POST",body:JSON.stringify(s?(0,d.A)({chapter:s},n||{}):n||{})})}(c,f?void 0:h,f||void 0,{profile:s,seed:l,options:D.current});b((null===e||void 0===e?void 0:e.chapter)||null)}catch(e){S((null===e||void 0===e?void 0:e.message)||"\u7f16\u8f91\u5931\u8d25")}finally{N(!1)}}},disabled:y||!c,className:"bg-violet-600 text-white rounded px-3 py-2 disabled:opacity-50",children:"\u7f16\u8f91\u964d\u7ea7"}),(0,r.jsx)("button",{onClick:async function(){if(c){S(null),N(!0);try{const e={ch1MinClues:R,minExposures:J},t=k?{draft:k,policy:e,updateOutlineExpected:!0}:{chapter:f,policy:e,updateOutlineExpected:!0},s=await async function(e,t){return j("/api/projects/".concat(e,"/autofix"),{method:"POST",body:JSON.stringify(t||{})})}(c,t);C((null===s||void 0===s?void 0:s.draft)||null),O(null)}catch(e){S((null===e||void 0===e?void 0:e.message)||"\u81ea\u52a8\u4fee\u8ba2\u5931\u8d25")}finally{N(!1)}}},disabled:y||!c||!f&&!k,className:"bg-amber-700 text-white rounded px-3 py-2 disabled:opacity-50",children:"\u81ea\u52a8\u4fee\u8ba2\u5668"}),(0,r.jsx)("button",{onClick:async function(){if(c&&k){N(!0),S(null);try{const e=await async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"html+interactive";return j("/api/projects/".concat(e,"/compile?format=").concat(encodeURIComponent(s)),{method:"POST",body:JSON.stringify({draft:t})})}(c,k,"html+interactive");O((null===e||void 0===e?void 0:e.urls)||null)}catch(e){S((null===e||void 0===e?void 0:e.message)||"\u5bfc\u51fa\u5931\u8d25")}finally{N(!1)}}},disabled:y||!c||!k,className:"bg-slate-700 text-white rounded px-3 py-2 disabled:opacity-50",children:"\u5bfc\u51fa HTML+\u4e92\u52a8\u5305"})]})]})]}),(0,r.jsxs)("div",{className:"md:col-span-2 space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,r.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,r.jsx)("h2",{className:"font-semibold",children:"\u84dd\u56fe Outline"})}),(0,r.jsx)("pre",{className:"text-xs whitespace-pre-wrap overflow-auto max-h-96",children:m?JSON.stringify(m,null,2):"\uff08\u5c1a\u672a\u751f\u6210\uff09"}),(0,r.jsx)("div",{className:"mt-2",children:(0,r.jsx)(g,{projectId:c,chapter:f,draft:k})})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,r.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,r.jsx)("h2",{className:"font-semibold",children:"\u7ae0\u8282 Chapter\uff08\u5199\u4f5c/\u7f16\u8f91\u7ed3\u679c\uff09"})}),(0,r.jsx)("pre",{className:"text-xs whitespace-pre-wrap overflow-auto max-h-96",children:f?JSON.stringify(f,null,2):"\uff08\u5c1a\u672a\u5199\u4f5c/\u7f16\u8f91\uff09"}),(0,r.jsx)("div",{className:"mt-2",children:(0,r.jsx)(g,{projectId:c,chapter:f,draft:k})})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,r.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,r.jsx)("h2",{className:"font-semibold",children:"\u6574\u7a3f Draft\uff08\u81ea\u52a8\u4fee\u8ba2\u4ea7\u7269\uff09"})}),(0,r.jsx)("pre",{className:"text-xs whitespace-pre-wrap overflow-auto max-h-96",children:k?JSON.stringify(k,null,2):"\uff08\u672a\u751f\u6210\u81ea\u52a8\u4fee\u8ba2\u7ed3\u679c\uff09"}),(0,r.jsx)("div",{className:"mt-2",children:(0,r.jsx)(g,{projectId:c,draft:k})}),E&&(0,r.jsxs)("div",{className:"mt-2 text-sm",children:[(0,r.jsx)("div",{children:"\u5bfc\u51fa\u5b8c\u6210\uff1a"}),(0,r.jsx)("div",{children:(0,r.jsx)("a",{className:"text-blue-600 underline",href:E.html,target:"_blank",rel:"noreferrer",children:"\u9884\u89c8 HTML"})}),(0,r.jsx)("div",{children:(0,r.jsx)("a",{className:"text-blue-600 underline",href:E.interactive,target:"_blank",rel:"noreferrer",children:"\u4e0b\u8f7d\u4e92\u52a8\u5305 JSON"})})]})]})]})]})]})})}function y(e){let{label:t}=e;const s="pass"===t?"bg-green-100 text-green-600":"warn"===t?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-600";return(0,r.jsx)("span",{className:"inline-block px-2 py-1 rounded text-xs mr-2 ".concat(s),children:t})}function g(e){var t,s,a;let{projectId:l,chapter:i,draft:c}=e;const[o,d]=n.useState(null),[u,p]=n.useState(!1);return(0,r.jsxs)("div",{children:[(0,r.jsx)("button",{disabled:!l||u,onClick:async function(){if(l){p(!0);try{const e=c?{draft:c}:i?{chapter:i}:{},t=await fetch("/api"+"/api/projects/".concat(l,"/validate"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json();if(!t.ok)throw new Error((null===s||void 0===s?void 0:s.error)||t.statusText);d((null===s||void 0===s?void 0:s.report)||null)}catch(e){alert((null===e||void 0===e?void 0:e.message)||"\u6821\u9a8c\u5931\u8d25")}finally{p(!1)}}},className:"bg-amber-600 text-white rounded px-3 py-2 disabled:opacity-50",children:"\u5feb\u901f\u6821\u9a8c"}),o&&(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsxs)("div",{className:"text-sm mb-1",children:["\u7ed3\u679c\uff1apass=",(null===o||void 0===o||null===(t=o.summary)||void 0===t?void 0:t.pass)||0," warn=",(null===o||void 0===o||null===(s=o.summary)||void 0===s?void 0:s.warn)||0," fail=",(null===o||void 0===o||null===(a=o.summary)||void 0===a?void 0:a.fail)||0]}),(0,r.jsx)("div",{className:"flex flex-wrap gap-1",children:(o.results||[]).map(e=>(0,r.jsxs)("div",{className:"border rounded px-2 py-1 text-xs",children:[(0,r.jsx)("b",{children:e.ruleId})," ",(0,r.jsx)(y,{label:e.status})]},e.ruleId))})]})]})}const N=function(){const[e,t]=n.useState(null),[s,a]=n.useState(null);return n.useEffect(()=>{},[s]),(0,r.jsx)(v,{children:(0,r.jsx)(l.Kd,{children:(0,r.jsxs)("div",{className:"App min-h-screen text-points-text",children:[(0,r.jsx)(o,{}),(0,r.jsx)(i.BV,{children:(0,r.jsx)(i.qh,{path:"/",element:(0,r.jsx)(b,{})})})]})})})};const w="".concat("","/service-worker.js"),S=e=>{window.confirm("\u6709\u65b0\u7248\u672c\u7684\u6545\u4e8b\u4f53\u9a8c\u53ef\u7528\uff0c\u662f\u5426\u7acb\u5373\u66f4\u65b0\uff1f")&&(e=>{e.waiting&&e.waiting.postMessage({type:"SKIP_WAITING"})})(e)};a.createRoot(document.getElementById("root")).render((0,r.jsx)(n.StrictMode,{children:(0,r.jsx)(N,{})})),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register(w).then(e=>{e.waiting&&S(e),e.addEventListener("updatefound",()=>{const t=e.installing;t&&t.addEventListener("statechange",()=>{"installed"===t.state&&navigator.serviceWorker.controller&&S(e)})});let t=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{t||(t=!0,window.location.reload())})}).catch(e=>{console.error("Service Worker \u6ce8\u518c\u5931\u8d25",e)})})}},e=>{e.O(0,[411,96],()=>{return t=658,e(e.s=t);var t});e.O()}]);