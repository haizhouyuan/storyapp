name: PR Auto Review with Claude

on:
  pull_request:
    types: [opened, synchronize, reopened]
    branches: [master, main]

permissions:
  contents: read
  pull-requests: write
  issues: write
  id-token: write

jobs:
  claude-review:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    env:
      ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
      ANTHROPIC_BASE_URL: ${{ secrets.ANTHROPIC_BASE_URL }}
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Auto Review PR with Claude
        uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          prompt: |
            è¯·å¯¹è¿™ä¸ªPRè¿›è¡Œå…¨é¢çš„ä»£ç è¯„å®¡ã€‚é‡ç‚¹å…³æ³¨ï¼š
            
            ## è¯„å®¡è¦ç‚¹
            1. **ä»£ç è´¨é‡**ï¼šä»£ç ç»“æ„ã€å¯è¯»æ€§ã€æœ€ä½³å®è·µ
            2. **å®‰å…¨æ€§**ï¼šæ½œåœ¨çš„å®‰å…¨æ¼æ´å’Œé£é™©  
            3. **æ€§èƒ½**ï¼šæ€§èƒ½é—®é¢˜å’Œä¼˜åŒ–å»ºè®®
            4. **æµ‹è¯•**ï¼šæµ‹è¯•è¦†ç›–åº¦å’Œæµ‹è¯•è´¨é‡
            5. **å„¿ç«¥åº”ç”¨ç‰¹æ®Šè¦æ±‚**ï¼š
               - COPPAåˆè§„æ€§ï¼ˆå„¿ç«¥éšç§ä¿æŠ¤ï¼‰
               - å†…å®¹å®‰å…¨æ€§å’Œè¿‡æ»¤
               - ç”¨æˆ·ä½“éªŒå‹å¥½æ€§
            
            ## è¾“å‡ºè¦æ±‚
            - æä¾›å…·ä½“çš„æ”¹è¿›å»ºè®®
            - æ ‡æ³¨ä¸¥é‡ç¨‹åº¦ï¼ˆğŸ”´ ä¸¥é‡ / ğŸŸ¡ å»ºè®® / ğŸŸ¢ è‰¯å¥½ï¼‰
            - ç»™å‡ºä»£ç ç¤ºä¾‹ï¼ˆå¦‚é€‚ç”¨ï¼‰
            - æ€»ä½“è¯„åˆ†å’Œå»ºè®®
            
            è¯·åœ¨PRä¸­ç•™ä¸‹è¯¦ç»†çš„è¯„å®¡è¯„è®ºã€‚